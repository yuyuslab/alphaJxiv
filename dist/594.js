/*! For license information please see 594.js.LICENSE.txt */
"use strict";(self.webpackChunkalphajxiv=self.webpackChunkalphajxiv||[]).push([[594],{125:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>s});var r=n(126);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const i="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=i){return this.instances.has(e)}getOptions(e=i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===i?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=i){return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},126:(e,t,n)=>{n.d(t,{cY:()=>g,FA:()=>O,g:()=>R,u:()=>a,Uj:()=>o,Fy:()=>y,tD:()=>q,bD:()=>L,hp:()=>U,T9:()=>d,Tj:()=>h,yU:()=>l,XA:()=>f,mS:()=>c,Ku:()=>$,ZQ:()=>I,sr:()=>S,zJ:()=>m,c1:()=>T,Im:()=>P,lT:()=>x,zW:()=>N,jZ:()=>E,lV:()=>C,nr:()=>A,Ov:()=>D,gE:()=>p,Am:()=>V,I9:()=>B,P1:()=>b,eX:()=>k});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}const u=()=>{try{return c().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},h=e=>{var t,n;return null===(n=null===(t=u())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},l=e=>{const t=h(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},d=()=>{var e;return null===(e=u())||void 0===e?void 0:e.config},f=e=>{var t;return null===(t=u())||void 0===t?void 0:t[`_${e}`]};class g{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function m(e){return e.endsWith(".cloudworkstations.dev")}async function p(e){return(await fetch(e,{credentials:"include"})).ok}function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(i)),""].join(".")}const v={};let w=!1;function b(e,t){if("undefined"==typeof window||"undefined"==typeof document||!m(window.location.host)||v[e]===t||v[e]||w)return;function n(e){return`__firebase__banner__${e}`}v[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(v))v[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),i=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{w=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,n),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function I(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function E(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(I())}function _(){var e;const t=null===(e=u())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function T(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function S(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function C(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function x(){const e=I();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function A(){return!_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function D(){return!_()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function N(){try{return"object"==typeof indexedDB}catch(e){return!1}}function k(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,O.prototype.create)}}class O{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(M,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new R(r,o,n)}}const M=/\{\$([^}]+)}/g;function P(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function L(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(F(n)&&F(i)){if(!L(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function F(e){return null!==e&&"object"==typeof e}function V(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function B(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function U(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function q(e,t){const n=new z(e,t);return n.subscribe.bind(n)}class z{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=j),void 0===r.error&&(r.error=j),void 0===r.complete&&(r.complete=j);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function j(){}function $(e){return e&&e._delegate?e._delegate:e}},424:(e,t,n)=>{n.d(t,{$b:()=>s,Vy:()=>u});const r=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=a[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}},594:(e,t,n)=>{n.r(t),n.d(t,{AbstractUserDataWriter:()=>gf,AggregateField:()=>id,AggregateQuerySnapshot:()=>od,Bytes:()=>ad,CACHE_SIZE_UNLIMITED:()=>jl,CollectionReference:()=>Rl,DocumentReference:()=>kl,DocumentSnapshot:()=>_f,FieldPath:()=>cd,FieldValue:()=>hd,Firestore:()=>$l,FirestoreError:()=>V,GeoPoint:()=>ld,LoadBundleTask:()=>zl,PersistentCacheIndexManager:()=>vg,Query:()=>Nl,QueryCompositeFilterConstraint:()=>Hd,QueryConstraint:()=>$d,QueryDocumentSnapshot:()=>Tf,QueryEndAtConstraint:()=>of,QueryFieldFilterConstraint:()=>Gd,QueryLimitConstraint:()=>Zd,QueryOrderByConstraint:()=>Yd,QuerySnapshot:()=>Sf,QueryStartAtConstraint:()=>nf,SnapshotMetadata:()=>Ef,Timestamp:()=>oe,Transaction:()=>ag,VectorValue:()=>dd,WriteBatch:()=>sg,_AutoId:()=>Y,_ByteString:()=>In,_DatabaseId:()=>Pn,_DocumentKey:()=>fe,_EmptyAppCheckTokenProvider:()=>H,_EmptyAuthCredentialsProvider:()=>q,_FieldPath:()=>de,_TestingHooks:()=>xg,_cast:()=>_l,_debugAssert:()=>P,_internalAggregationQueryToProtoRunAggregationQueryRequest:()=>Cg,_internalQueryToProtoQueryTarget:()=>Sg,_isBase64Available:()=>bn,_logWarn:()=>N,_validateIsNotUsedTogether:()=>wl,addDoc:()=>Vf,aggregateFieldEqual:()=>bf,aggregateQuerySnapshotEqual:()=>If,and:()=>Xd,arrayRemove:()=>dg,arrayUnion:()=>lg,average:()=>vf,clearIndexedDbPersistence:()=>Jl,collection:()=>Ol,collectionGroup:()=>Ml,connectFirestoreEmulator:()=>Dl,count:()=>wf,deleteAllPersistentCacheIndexes:()=>Eg,deleteDoc:()=>Ff,deleteField:()=>ug,disableNetwork:()=>td,disablePersistentCacheIndexAutoCreation:()=>Ig,doc:()=>Pl,documentId:()=>ud,enableIndexedDbPersistence:()=>Wl,enableMultiTabIndexedDbPersistence:()=>Xl,enableNetwork:()=>ed,enablePersistentCacheIndexAutoCreation:()=>bg,endAt:()=>cf,endBefore:()=>af,ensureFirestoreConfigured:()=>Ql,executeWrite:()=>qf,getAggregateFromServer:()=>$f,getCountFromServer:()=>jf,getDoc:()=>Af,getDocFromCache:()=>Nf,getDocFromServer:()=>kf,getDocs:()=>Rf,getDocsFromCache:()=>Of,getDocsFromServer:()=>Mf,getFirestore:()=>Gl,getPersistentCacheIndexManager:()=>wg,increment:()=>fg,initializeFirestore:()=>Kl,limit:()=>ef,limitToLast:()=>tf,loadBundle:()=>rd,memoryEagerGarbageCollector:()=>Wf,memoryLocalCache:()=>Yf,memoryLruGarbageCollector:()=>Xf,namedQuery:()=>sd,onSnapshot:()=>Bf,onSnapshotsInSync:()=>Uf,or:()=>Wd,orderBy:()=>Jd,persistentLocalCache:()=>Jf,persistentMultipleTabManager:()=>ng,persistentSingleTabManager:()=>tg,query:()=>Kd,queryEqual:()=>Fl,refEqual:()=>Ll,runTransaction:()=>cg,serverTimestamp:()=>hg,setDoc:()=>Pf,setIndexConfiguration:()=>pg,setLogLevel:()=>x,snapshotEqual:()=>xf,startAfter:()=>sf,startAt:()=>rf,sum:()=>yf,terminate:()=>nd,updateDoc:()=>Lf,vector:()=>gg,waitForPendingWrites:()=>Zl,where:()=>Qd,writeBatch:()=>mg});var r,s,i=n(990),o=n(125),a=n(424),c=n(126),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function i(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,s=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o={};function a(e){return-128<=e&&128>e?function(e){var t=o;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],0>e?-1:0)}(e)}(e):new i([0|e],0>e?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return u;if(0>e)return m(c(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var u=a(0),l=a(1),d=a(16777216);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return-1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(l)}function p(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(u,u);if(g(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;0>=r.l(e);)n=b(n),r=b(r);var s=I(n,1),i=I(r,1);for(r=I(r,2),n=I(n,2);!f(r);){var o=i.add(r);0>=o.l(e)&&(s=s.add(n),i=o),r=I(r,1),n=I(n,1)}return t=p(e,s.j(t)),new v(s,t)}for(s=u;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=c(n)).j(t);g(o)||0<o.l(e);)o=(i=c(n-=r)).j(t);f(i)&&(i=l),s=s.add(i),e=p(e,o)}return new v(s,e)}function b(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function I(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(s,e.h)}(e=i.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=c(Math.pow(e,6)),n=this,r="";;){var s=w(n,t).g,i=((0<(n=p(n,s.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return g(e=p(this,e))?-1:f(e)?0:1},e.abs=function(){return g(this)?m(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return u;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(d)&&0>e.l(d))return c(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var o=this.i(r)>>>16,a=65535&this.i(r),h=e.i(s)>>>16,l=65535&e.i(s);n[2*r+2*s]+=a*l,y(n,2*r+2*s),n[2*r+2*s+1]+=o*l,y(n,2*r+2*s+1),n[2*r+2*s+1]+=a*h,y(n,2*r+2*s+1),n[2*r+2*s+2]+=o*h,y(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},e.A=function(e){return w(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,s=h.Md5=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=c,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(n,8)),s=u,i=0;i<t.length;i+=8){var o=Math.min(8,t.length-i),a=parseInt(t.substring(i,i+o),n);8>o?(o=c(Math.pow(n,o)),s=s.j(o).add(c(a))):s=(s=s.j(r)).add(c(a))}return s},r=h.Integer=i}).apply(void 0!==u?u:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var l,d,f,g,m,p,y,v,w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},b={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof w&&w];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,s={next:function(){if(!r&&n<e.length){var s=n++;return{value:t(0,e[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(e,t){return t}))}}));var r=r||{},s=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}function E(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(i(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let s=0;s<r;s++)e[t+s]=n[s]}else e.push(n)}}function T(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var x=!(-1==S().indexOf("Gecko")||-1!=S().toLowerCase().indexOf("webkit")&&-1==S().indexOf("Edge")||-1!=S().indexOf("Trident")||-1!=S().indexOf("MSIE")||-1!=S().indexOf("Edge"));function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function D(e){const t={};for(const n in e)t[n]=e[n];return t}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<N.length;t++)n=N[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function R(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function O(e){s.setTimeout((()=>{throw e}),0)}function M(){var e=B;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var P=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new L),(e=>e.reset()));class L{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let F,V=!1,B=new class{constructor(){this.h=this.g=null}add(e,t){const n=P.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},U=()=>{const e=s.Promise.resolve(void 0);F=()=>{e.then(q)}};var q=()=>{for(var e;e=M();){try{e.h.call(e.g)}catch(e){O(e)}var t=P;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}V=!1};function z(){this.s=this.s,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}z.prototype.s=!1,z.prototype.ma=function(){this.s||(this.s=!0,this.N())},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var $=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function K(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(x){e:{try{C(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:G[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&K.aa.h.call(this)}}I(K,j);var G={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),H=0;function W(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++H,this.da=this.fa=!1}function X(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Y(e){this.src=e,this.g={},this.h=0}function J(e,t){var n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Z(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}Y.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=Z(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new W(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var ee="closure_lm_"+(1e6*Math.random()|0),te={};function ne(e,t,n,r,s){if(r&&r.once)return se(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)ne(e,t[i],n,r,s);return null}return n=le(n),e&&e[Q]?e.K(t,n,o(r)?!!r.capture:!!r,s):re(e,t,n,!1,r,s)}function re(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=ue(e);if(c||(e[ee]=c=new Y(e)),(n=c.add(t,n,r,a,i)).proxy)return n;if(r=function(){const e=ce;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)$||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(ae(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function se(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)se(e,t[i],n,r,s);return null}return n=le(n),e&&e[Q]?e.L(t,n,o(r)?!!r.capture:!!r,s):re(e,t,n,!0,r,s)}function ie(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)ie(e,t[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=le(n),e&&e[Q]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Z(i=e.g[t],n,r,s))&&(X(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=ue(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Z(t,n,r,s)),(n=-1<e?t[e]:null)&&oe(n))}function oe(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[Q])J(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ae(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ue(t))?(J(n,e),0==n.h&&(n.src=null,t[ee]=null)):X(e)}}}function ae(e){return e in te?te[e]:te[e]="on"+e}function ce(e,t){if(e.da)e=!0;else{t=new K(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&oe(e),e=n.call(r,t)}return e}function ue(e){return(e=e[ee])instanceof Y?e:null}var he="__closure_events_fn_"+(1e9*Math.random()>>>0);function le(e){return"function"==typeof e?e:(e[he]||(e[he]=function(t){return e.handleEvent(t)}),e[he])}function de(){z.call(this),this.i=new Y(this),this.M=this,this.F=null}function fe(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var s=t;k(t=new j(r,e),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=ge(o,r,!0,t)&&s}if(s=ge(o=t.g=e,r,!0,t)&&s,s=ge(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)s=ge(o=t.g=n[i],r,!1,t)&&s}function ge(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&J(e.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}function me(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function pe(e){e.g=me((()=>{e.g=null,e.i&&(e.i=!1,pe(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}I(de,z),de.prototype[Q]=!0,de.prototype.removeEventListener=function(e,t,n,r){ie(this,e,t,n,r)},de.prototype.N=function(){if(de.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.F=null},de.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},de.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ye extends z{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:pe(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ve(e){z.call(this),this.h=e,this.g={}}I(ve,z);var we=[];function be(e){A(e.g,(function(e,t){this.g.hasOwnProperty(t)&&oe(e)}),e),e.g={}}ve.prototype.N=function(){ve.aa.N.call(this),be(this)},ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ie=s.JSON.stringify,Ee=s.JSON.parse,_e=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function Te(){}function Se(e){return e.h||(e.h=e.i())}function Ce(){}Te.prototype.h=null;var xe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ae(){j.call(this,"d")}function De(){j.call(this,"c")}I(Ae,j),I(De,j);var Ne={},ke=null;function Re(){return ke=ke||new de}function Oe(e){j.call(this,Ne.La,e)}function Me(e){const t=Re();fe(t,new Oe(t))}function Pe(e,t){j.call(this,Ne.STAT_EVENT,e),this.stat=t}function Le(e){const t=Re();fe(t,new Pe(t,e))}function Fe(e,t){j.call(this,Ne.Ma,e),this.size=t}function Ve(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){e()}),t)}function Be(){this.g=!0}function Ue(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ie(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ne.La="serverreachability",I(Oe,j),Ne.STAT_EVENT="statevent",I(Pe,j),Ne.Ma="timingevent",I(Fe,j),Be.prototype.xa=function(){this.g=!1},Be.prototype.info=function(){};var qe,ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},je={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function $e(){}function Ke(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ve(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ge}function Ge(){this.i=null,this.g="",this.h=!1}I($e,Te),$e.prototype.g=function(){return new XMLHttpRequest},$e.prototype.i=function(){return{}},qe=new $e;var Qe={},He={};function We(e,t,n){e.L=1,e.v=It(pt(t)),e.m=n,e.P=!0,Xe(e,null)}function Xe(e,t){e.F=Date.now(),Ze(e),e.A=pt(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Pt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ge,e.g=_n(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ye(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(we[0]=s.toString()),s=we);for(var i=0;i<s.length;i++){var o=ne(n,s[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Me(),function(e,t,n,r,s,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ye(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Je(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?He:(n=Number(t.substring(n,r)),isNaN(n)?Qe:(r+=1)+n>t.length?He:(t=t.slice(r,r+n),e.C=r+n,t))}function Ze(e){e.S=Date.now()+e.I,et(e,e.I)}function et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ve(u(e.ba,e),t)}function tt(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function nt(e){0==e.j.G||e.J||vn(e.j,e)}function rt(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,be(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function st(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||ut(n.h,e)))if(!e.K&&ut(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;yn(n),an(n)}gn(n),Le(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ve(u(n.Za,n),6e3));if(1>=ct(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else bn(n,11)}else if((e.K||n.g==e)&&yn(n),!T(t))for(s=n.Da.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const s=u[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ht(i,i.h),i.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,bt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=En(r,r.J?r.ia:null,r.W),o.K){lt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(tt(a),Ze(a)),r.g=o}else fn(r);0<n.i.length&&un(n)}else"stop"!=u[0]&&"close"!=u[0]||bn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?bn(n,7):on(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Me()}catch(e){}}Ke.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==tn(e)?t.j():this.Y(e)},Ke.prototype.Y=function(e){try{if(e==this.g)e:{const d=tn(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==t||Me(),tt(this);var n=this.g.Z();this.X=n;t:if(Ye(this)){var r=nn(this.g);e="";var i=r.length,o=4==tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){rt(this),nt(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,s,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(c)){var h=c;break t}}h=null}if(!(n=h)){this.o=!1,this.s=3,Le(12),rt(this),nt(this);break e}Ue(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,st(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Je(this,a),e==He){4==d&&(this.s=4,Le(14),n=!1),Ue(this.i,this.l,null,"[Incomplete Response]");break}if(e==Qe){this.s=4,Le(15),Ue(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ue(this.i,this.l,e,null),st(this,e)}if(Ye(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Le(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(l),l.M=!0,Le(11))}}else Ue(this.i,this.l,a,"[Invalid Chunked Response]"),rt(this),nt(this)}else Ue(this.i,this.l,a,null),st(this,a);4==d&&rt(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,Ze(this)))}else(function(e){const t={};e=(e.g&&2<=tn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(T(e[r]))continue;var n=R(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Le(12)):(this.s=0,Le(13)),rt(this),nt(this)}}}catch(e){}},Ke.prototype.cancel=function(){this.J=!0,rt(this)},Ke.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Me(),Le(17)),rt(this),this.s=2,nt(this)):et(this,this.S-e)};var it=class{constructor(e,t){this.g=e,this.map=t}};function ot(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function at(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ct(e){return e.h?1:e.g?e.g.size:0}function ut(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ht(e,t){e.g?e.g.add(t):e.h=t}function lt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return E(e.i)}function ft(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,o=0;o<s;o++)t.call(void 0,r[o],n&&n[o],e)}ot.prototype.cancel=function(){if(this.i=dt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var gt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof mt){this.h=e.h,yt(this,e.j),this.o=e.o,this.g=e.g,vt(this,e.s),this.l=e.l;var t=e.i,n=new kt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),wt(this,n),this.m=e.m}else e&&(t=String(e).match(gt))?(this.h=!1,yt(this,t[1]||"",!0),this.o=Et(t[2]||""),this.g=Et(t[3]||"",!0),vt(this,t[4]),this.l=Et(t[5]||"",!0),wt(this,t[6]||"",!0),this.m=Et(t[7]||"")):(this.h=!1,this.i=new kt(null,this.h))}function pt(e){return new mt(e)}function yt(e,t,n){e.j=n?Et(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function wt(e,t,n){t instanceof kt?(e.i=t,function(e,t){t&&!e.j&&(Rt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ot(this,t),Pt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=_t(t,Dt)),e.i=new kt(t,e.h))}function bt(e,t,n){e.i.set(t,n)}function It(e){return bt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Et(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function _t(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Tt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Tt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(_t(t,Ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(_t(t,Ct,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(_t(n,"/"==n.charAt(0)?At:xt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",_t(n,Nt)),e.join("")};var St,Ct=/[#\/\?@]/g,xt=/[#\?:]/g,At=/[#\?]/g,Dt=/[#\?@]/g,Nt=/#/g;function kt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Rt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ot(e,t){Rt(e),t=Lt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Mt(e,t){return Rt(e),t=Lt(e,t),e.g.has(t)}function Pt(e,t,n){Ot(e,t),0<n.length&&(e.i=null,e.g.set(Lt(e,t),E(n)),e.h+=n.length)}function Lt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ft(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(e){}}function Vt(){this.g=new _e}function Bt(e,t,n){const r=n||"";try{ft(e,(function(e,n){let s=e;o(e)&&(s=Ie(e)),t.push(r+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ut(e){this.l=e.Ub||null,this.j=e.eb||!1}function qt(e,t){de.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function zt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function jt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,$t(e)}function $t(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Kt(e){let t="";return A(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Gt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Kt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):bt(e,t,n))}function Qt(e){de.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=kt.prototype).add=function(e,t){Rt(this),this.i=null,e=Lt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Rt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){Rt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const s=e[r];for(let e=0;e<s.length;e++)n.push(t[r])}return n},e.V=function(e){Rt(this);let t=[];if("string"==typeof e)Mt(this,e)&&(t=t.concat(this.g.get(Lt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Rt(this),this.i=null,Mt(this,e=Lt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const i=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")},I(Ut,Te),Ut.prototype.g=function(){return new qt(this.l,this.j)},Ut.prototype.i=(St={},function(){return St}),I(qt,de),(e=qt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,$t(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,$t(this)),this.g&&(this.readyState=3,$t(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?jt(this):$t(this),3==this.readyState&&zt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,jt(this))},e.Qa=function(e){this.g&&(this.response=e,jt(this))},e.ga=function(){this.g&&jt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(qt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),I(Qt,de);var Ht=/^https?$/i,Wt=["POST","PUT"];function Xt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Yt(e),Zt(e)}function Yt(e){e.A||(e.A=!0,fe(e,"complete"),fe(e,"error"))}function Jt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=tn(e)||2!=e.Z()))if(e.u&&4==tn(e))me(e.Ea,0,e);else if(fe(e,"readystatechange"),4==tn(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===r){var o=String(e.D).match(gt)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!Ht.test(o?o.toLowerCase():"")}n=i}if(n)fe(e,"complete"),fe(e,"success");else{e.m=6;try{var a=2<tn(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Yt(e)}}finally{Zt(e)}}}function Zt(e,t){if(e.g){en(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||fe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function en(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function tn(e){return e.g?e.g.readyState:0}function nn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function rn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function sn(e){this.Aa=0,this.i=[],this.j=new Be,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,e),this.cb=rn("retryDelaySeedMs",1e4,e),this.Wa=rn("forwardChannelMaxRetries",2,e),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new ot(e&&e.concurrentRequestLimit),this.Da=new Vt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(e){if(cn(e),3==e.G){var t=e.U++,n=pt(e.I);if(bt(n,"SID",e.K),bt(n,"RID",t),bt(n,"TYPE","terminate"),ln(e,n),(t=new Ke(e,e.j,t)).L=2,t.v=It(pt(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&s.Image&&((new Image).src=t.v,n=!0),n||(t.g=_n(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ze(t)}In(e)}function an(e){e.g&&(mn(e),e.g.cancel(),e.g=null)}function cn(e){an(e),e.u&&(s.clearTimeout(e.u),e.u=null),yn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function un(e){if(!at(e.h)&&!e.s){e.s=!0;var t=e.Ga;F||U(),V||(F(),V=!0),B.add(t,e),e.B=0}}function hn(e,t){var n;n=t?t.l:e.U++;const r=pt(e.I);bt(r,"SID",e.K),bt(r,"RID",n),bt(r,"AID",e.T),ln(e,r),e.m&&e.o&&Gt(r,e.m,e.o),n=new Ke(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=dn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),ht(e.h,n),We(n,r,t)}function ln(e,t){e.H&&A(e.H,(function(e,n){bt(t,n,e)})),e.l&&ft({},(function(e,n){bt(t,n,e)}))}function dn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),i=!1;else try{Bt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(i){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function fn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;F||U(),V||(F(),V=!0),B.add(t,e),e.v=0}}function gn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ve(u(e.Fa,e),wn(e,e.v)),e.v++,0))}function mn(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function pn(e){e.g=new Ke(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=pt(e.qa);bt(t,"RID","rpc"),bt(t,"SID",e.K),bt(t,"AID",e.T),bt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&bt(t,"TO",e.ja),bt(t,"TYPE","xmlhttp"),ln(e,t),e.m&&e.o&&Gt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=It(pt(t)),n.m=null,n.P=!0,Xe(n,e)}function yn(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function vn(e,t){var n=null;if(e.g==t){yn(e),mn(e),e.g=null;var r=2}else{if(!ut(e.h,t))return;n=t.D,lt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;fe(r=Re(),new Fe(r,n)),un(e)}else fn(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==r&&function(e,t){return!(ct(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ve(u(e.Ga,e,t),wn(e,e.B)),e.B++,0)))}(e,t)||2==r&&gn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:bn(e,5);break;case 4:bn(e,10);break;case 3:bn(e,6);break;default:bn(e,2)}}function wn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function bn(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new mt(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||yt(r,"https"),It(r),t?function(e,t){const n=new Be;if(s.Image){const r=new Image;r.onload=h(Ft,n,"TestLoadImage: loaded",!0,t,r),r.onerror=h(Ft,n,"TestLoadImage: error",!1,t,r),r.onabort=h(Ft,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=h(Ft,n,"TestLoadImage: timeout",!1,t,r),s.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Be;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ft(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Ft(0,0,!0,t):Ft(0,0,!1,t)})).catch((()=>{clearTimeout(r),Ft(0,0,!1,t)}))}(r.toString(),n)}else Le(2);e.G=0,e.l&&e.l.sa(t),In(e),cn(e)}function In(e){if(e.G=0,e.ka=[],e.l){const t=dt(e.h);0==t.length&&0==e.i.length||(_(e.ka,t),_(e.ka,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.ra()}}function En(e,t,n){var r=n instanceof mt?pt(n):new mt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),vt(r,r.s);else{var i=s.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new mt(null);r&&yt(o,r),t&&(o.g=t),i&&vt(o,i),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&bt(r,n,t),bt(r,"VER",e.la),ln(e,r),r}function _n(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Qt(new Ut({eb:n})):new Qt(e.pa)).Ha(e.J),t}function Tn(){}function Sn(){}function Cn(e,t){de.call(this),this.g=new sn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!T(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Dn(this)}function xn(e){Ae.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){De.call(this),this.status=1}function Dn(e){this.g=e}(e=Qt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qe.g(),this.v=this.o?Se(this.o):Se(qe),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Xt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Wt,t,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{en(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Xt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,fe(this,"complete"),fe(this,"abort"),Zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zt(this,!0)),Qt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Jt(this):this.bb())},e.bb=function(){Jt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<tn(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ee(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=sn.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Le(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=En(this,null,this.W),un(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Ke(this,this.j,e);let i=this.o;if(this.S&&(i?(i=D(i),k(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=dn(this,s,t),bt(n=pt(this.I),"RID",e),bt(n,"CVER",22),this.D&&bt(n,"X-HTTP-Session-Id",this.D),ln(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Kt(i)))+"&"+t:this.m&&Gt(n,this.m,i)),ht(this.h,s),this.Ua&&bt(n,"TYPE","init"),this.P?(bt(n,"$req",t),bt(n,"SID","null"),s.T=!0,We(s,n,null)):We(s,n,t),this.G=2}}else 3==this.G&&(e?hn(this,e):0==this.i.length||at(this.h)||hn(this))},e.Fa=function(){if(this.u=null,pn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ve(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Le(10),an(this),pn(this))},e.Za=function(){null!=this.C&&(this.C=null,an(this),gn(this),Le(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Le(2)):(this.j.info("Failed to ping google.com"),Le(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Tn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Sn.prototype.g=function(e,t){return new Cn(e,t)},I(Cn,de),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){on(this.g)},Cn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=Ie(e),e=n);t.i.push(new it(t.Ya++,e)),3==t.G&&un(t)},Cn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,Cn.aa.N.call(this)},I(xn,Ae),I(An,De),I(Dn,Tn),Dn.prototype.ua=function(){fe(this.g,"a")},Dn.prototype.ta=function(e){fe(this.g,new xn(e))},Dn.prototype.sa=function(e){fe(this.g,new An)},Dn.prototype.ra=function(){fe(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,v=b.createWebChannelTransport=function(){return new Sn},y=b.getStatEventTarget=function(){return Re()},p=b.Event=Ne,m=b.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ze.NO_ERROR=0,ze.TIMEOUT=8,ze.HTTP_ERROR=6,g=b.ErrorCode=ze,je.COMPLETE="complete",f=b.EventType=je,Ce.EventType=xe,xe.OPEN="a",xe.CLOSE="b",xe.ERROR="c",xe.MESSAGE="d",de.prototype.listen=de.prototype.K,d=b.WebChannel=Ce,b.FetchXmlHttpFactory=Ut,Qt.prototype.listenOnce=Qt.prototype.L,Qt.prototype.getLastError=Qt.prototype.Ka,Qt.prototype.getLastErrorCode=Qt.prototype.Ba,Qt.prototype.getStatus=Qt.prototype.Z,Qt.prototype.getResponseJson=Qt.prototype.Oa,Qt.prototype.getResponseText=Qt.prototype.oa,Qt.prototype.send=Qt.prototype.ea,Qt.prototype.setWithCredentials=Qt.prototype.Ha,l=b.XhrIo=Qt}).apply(void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const I="@firebase/firestore",E="4.7.17";class _{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_.UNAUTHENTICATED=new _(null),_.GOOGLE_CREDENTIALS=new _("google-credentials-uid"),_.FIRST_PARTY=new _("first-party-uid"),_.MOCK_USER=new _("mock-user");let T="11.9.0";const S=new a.Vy("@firebase/firestore");function C(){return S.logLevel}function x(e){S.setLogLevel(e)}function A(e,...t){if(S.logLevel<=a.$b.DEBUG){const n=t.map(k);S.debug(`Firestore (${T}): ${e}`,...n)}}function D(e,...t){if(S.logLevel<=a.$b.ERROR){const n=t.map(k);S.error(`Firestore (${T}): ${e}`,...n)}}function N(e,...t){if(S.logLevel<=a.$b.WARN){const n=t.map(k);S.warn(`Firestore (${T}): ${e}`,...n)}}function k(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function R(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,O(e,r,n)}function O(e,t,n){let r=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw D(r),new Error(r)}function M(e,t,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,e||O(t,s,r)}function P(e,t){e||R(57014,t)}function L(e,t){return e}const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends c.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class B{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class U{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class q{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(_.UNAUTHENTICATED)))}shutdown(){}}class z{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class j{constructor(e){this.t=e,this.currentUser=_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){M(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new B;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new B,e.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new B)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(M("string"==typeof t.accessToken,31837,{l:t}),new U(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return M(null===e||"string"==typeof e,2055,{h:e}),new _(e)}}class ${constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=_.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class K{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new $(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(_.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class G{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Q{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,i.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){M(void 0===this.o,3512);const n=e=>{null!=e.error&&A("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,A("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new G(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(M("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new G(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class H{getToken(){return Promise.resolve(new G(""))}invalidateToken(){}start(e,t){}shutdown(){}}function W(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function X(){return new TextEncoder}class Y{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=W(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function J(e,t){return e<t?-1:e>t?1:0}function Z(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),s=t.codePointAt(n);if(r!==s){if(r<128&&s<128)return J(r,s);{const i=X(),o=te(i.encode(ee(e,n)),i.encode(ee(t,n)));return 0!==o?o:J(r,s)}}n+=r>65535?2:1}return J(e.length,t.length)}function ee(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function te(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return J(e[n],t[n]);return J(e.length,t.length)}function ne(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function re(e){return e+"\0"}const se=-62135596800,ie=1e6;class oe{static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*ie);return new oe(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<se)throw new V(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ie}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-se;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new oe(0,0))}static max(){return new ae(new oe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ce="__name__";class ue{constructor(e,t,n){void 0===t?t=0:t>e.length&&R(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&R(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ue.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ue?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=ue.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return J(e.length,t.length)}static compareSegments(e,t){const n=ue.isNumericId(e),r=ue.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ue.extractNumericId(e).compare(ue.extractNumericId(t)):Z(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class he extends ue{construct(e,t,n){return new he(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new V(F.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new he(t)}static emptyPath(){return new he([])}}const le=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class de extends ue{construct(e,t,n){return new de(e,t,n)}static isValidIdentifier(e){return le.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),de.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ce}static keyField(){return new de([ce])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new V(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new V(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new V(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new V(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new de(t)}static emptyPath(){return new de([])}}class fe{constructor(e){this.path=e}static fromPath(e){return new fe(he.fromString(e))}static fromName(e){return new fe(he.fromString(e).popFirst(5))}static empty(){return new fe(he.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===he.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return he.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fe(new he(e.slice()))}}const ge=-1;class me{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function pe(e){return e.fields.find((e=>2===e.kind))}function ye(e){return e.fields.filter((e=>2!==e.kind))}function ve(e,t){let n=J(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(n=be(e.fields[r],t.fields[r]),0!==n)return n;return J(e.fields.length,t.fields.length)}me.UNKNOWN_ID=-1;class we{constructor(e,t){this.fieldPath=e,this.kind=t}}function be(e,t){const n=de.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:J(e.kind,t.kind)}class Ie{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ie(0,Te.min())}}function Ee(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=ae.fromTimestamp(1e9===r?new oe(n+1,0):new oe(n,r));return new Te(s,fe.empty(),t)}function _e(e){return new Te(e.readTime,e.key,ge)}class Te{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Te(ae.min(),fe.empty(),ge)}static max(){return new Te(ae.max(),fe.empty(),ge)}}function Se(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=fe.comparator(e.documentKey,t.documentKey),0!==n?n:J(e.largestBatchId,t.largestBatchId))}const Ce="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ae(e){if(e.code!==F.FAILED_PRECONDITION||e.message!==Ce)throw e;A("LocalStore","Unexpectedly lost primary lease")}class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&R(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new De(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof De?t:De.resolve(t)}catch(e){return De.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):De.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):De.reject(t)}static resolve(e){return new De(((t,n)=>{t(e)}))}static reject(e){return new De(((t,n)=>{n(e)}))}static waitFor(e){return new De(((t,n)=>{let r=0,s=0,i=!1;e.forEach((e=>{++r,e.next((()=>{++s,i&&s===r&&t()}),(e=>n(e)))})),i=!0,s===r&&t()}))}static or(e){let t=De.resolve(!1);for(const n of e)t=t.next((e=>e?De.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new De(((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next((e=>{i[c]=e,++o,o===s&&n(i)}),(e=>r(e)))}}))}static doWhile(e,t){return new De(((n,r)=>{const s=()=>{!0===e()?t().next((()=>{s()}),r):n()};s()}))}}const Ne="SimpleDb";class ke{static open(e,t,n,r){try{return new ke(t,e.transaction(r,n))}catch(e){throw new Pe(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new B,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Pe(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=Ue(t.target.error);this.S.reject(new Pe(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(A(Ne,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Fe(t)}}class Re{static delete(e){return A(Ne,"Removing database:",e),Ve((0,c.mS)().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,c.zW)())return!1;if(Re.F())return!0;const e=(0,c.ZQ)(),t=Re.M(e),n=0<t&&t<10,r=Oe(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===Re.M((0,c.ZQ)())&&D("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(A(Ne,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Pe(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new V(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new V(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Pe(e,r))},r.onupgradeneeded=e=>{A(Ne,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,r.transaction,e.oldVersion,this.version).next((()=>{A(Ne,"Database upgrade to version "+this.version+" complete")}))}})),this.db.addEventListener("close",(e=>{const t=e.target;this.L=t.version}),{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.k(e);const t=ke.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next((e=>(t.v(),e))).catch((e=>(t.abort(e),De.reject(e)))).toPromise();return i.catch((()=>{})),await t.D,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(A(Ne,"Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Oe(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Me{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return Ve(this.K.delete())}}class Pe extends V{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Le(e){return"IndexedDbTransactionError"===e.name}class Fe{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(A(Ne,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(A(Ne,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ve(n)}add(e){return A(Ne,"ADD",this.store.name,e,e),Ve(this.store.add(e))}get(e){return Ve(this.store.get(e)).next((t=>(void 0===t&&(t=null),A(Ne,"GET",this.store.name,e,t),t)))}delete(e){return A(Ne,"DELETE",this.store.name,e),Ve(this.store.delete(e))}count(){return A(Ne,"COUNT",this.store.name),Ve(this.store.count())}J(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new De(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.Y(e,((e,n)=>{t.push(n)})).next((()=>t))}}Z(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new De(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}X(e,t){A(Ne,"DELETE ALL",this.store.name);const n=this.options(e,t);n.ee=!1;const r=this.cursor(n);return this.Y(r,((e,t,n)=>n.delete()))}te(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Y(r,t)}ne(e){const t=this.cursor({});return new De(((n,r)=>{t.onerror=e=>{const t=Ue(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Y(e,t){const n=[];return new De(((r,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void r();const i=new Me(s),o=t(s.primaryKey,s.value,i);if(o instanceof De){const e=o.catch((e=>(i.done(),De.reject(e))));n.push(e)}i.isDone?r():null===i.j?s.continue():s.continue(i.j)}})).next((()=>De.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ve(e){return new De(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Ue(e.target.error);n(t)}}))}let Be=!1;function Ue(e){const t=Re.M((0,c.ZQ)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Be||(Be=!0,setTimeout((()=>{throw e}),0)),e}}return e}const qe="IndexBackfiller";class ze{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){A(qe,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const e=await this.re.se();A(qe,`Documents written: ${e}`)}catch(e){Le(e)?A(qe,"Ignoring IndexedDB error during index backfill: ",e):await Ae(e)}await this.ie(6e4)}))}}class je{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.oe(t,e)))}oe(e,t){const n=new Set;let r=t,s=!0;return De.doWhile((()=>!0===s&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return A(qe,`Processing collection: ${t}`),this._e(e,t,r).next((e=>{r-=e,n.add(t)}));s=!1})))).next((()=>t-r))}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next((()=>this.ae(r,n))).next((n=>(A(qe,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>s.size))}))))}ae(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=_e(t);Se(r,n)>0&&(n=r)})),new Te(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class $e{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}$e.le=-1;const Ke=-1;function Ge(e){return null==e}function Qe(e){return 0===e&&1/e==-1/0}function He(e){return"number"==typeof e&&Number.isInteger(e)&&!Qe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const We="";function Xe(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Je(t)),t=Ye(e.get(n),t);return Je(t)}function Ye(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case We:n+="";break;default:n+=r}}return n}function Je(e){return e+We+""}function Ze(e){const t=e.length;if(M(t>=2,64408,{path:e}),2===t)return M(e.charAt(0)===We&&""===e.charAt(1),56145,{path:e}),he.emptyPath();const n=t-2,r=[];let s="";for(let i=0;i<t;){const t=e.indexOf(We,i);switch((t<0||t>n)&&R(50515,{path:e}),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=e.substring(i,t),s+="\0";break;case"":s+=e.substring(i,t+1);break;default:R(61167,{path:e})}i=t+2}return new he(r)}const et="remoteDocuments",tt="owner",nt="owner",rt="mutationQueues",st="mutations",it="batchId",ot="userMutationsIndex",at=["userId","batchId"];function ct(e,t){return[e,Xe(t)]}function ut(e,t,n){return[e,Xe(t),n]}const ht={},lt="documentMutations",dt="remoteDocumentsV14",ft=["prefixPath","collectionGroup","readTime","documentId"],gt="documentKeyIndex",mt=["prefixPath","collectionGroup","documentId"],pt="collectionGroupIndex",yt=["collectionGroup","readTime","prefixPath","documentId"],vt="remoteDocumentGlobal",wt="remoteDocumentGlobalKey",bt="targets",It="queryTargetsIndex",Et=["canonicalId","targetId"],_t="targetDocuments",Tt=["targetId","path"],St="documentTargetsIndex",Ct=["path","targetId"],xt="targetGlobalKey",At="targetGlobal",Dt="collectionParents",Nt=["collectionId","parent"],kt="clientMetadata",Rt="bundles",Ot="namedQueries",Mt="indexConfiguration",Pt="collectionGroupIndex",Lt="indexState",Ft=["indexId","uid"],Vt="sequenceNumberIndex",Bt=["uid","sequenceNumber"],Ut="indexEntries",qt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],zt="documentKeyIndex",jt=["indexId","uid","orderedDocumentKey"],$t="documentOverlays",Kt=["userId","collectionPath","documentId"],Gt="collectionPathOverlayIndex",Qt=["userId","collectionPath","largestBatchId"],Ht="collectionGroupOverlayIndex",Wt=["userId","collectionGroup","largestBatchId"],Xt="globals",Yt=[rt,st,lt,et,bt,tt,At,_t,kt,vt,Dt,Rt,Ot],Jt=[...Yt,$t],Zt=[rt,st,lt,dt,bt,tt,At,_t,kt,vt,Dt,Rt,Ot,$t],en=Zt,tn=[...en,Mt,Lt,Ut],nn=tn,rn=[...tn,Xt],sn=rn;class on extends xe{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function an(e,t){const n=L(e);return Re.N(n.he,t)}function cn(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function un(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function hn(e,t){const n=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function ln(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class dn{constructor(e,t){this.comparator=e,this.root=t||gn.EMPTY}insert(e,t){return new dn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,gn.BLACK,null,null))}remove(e){return new dn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fn(this.root,e,this.comparator,!1)}getReverseIterator(){return new fn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fn(this.root,e,this.comparator,!0)}}class fn{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class gn{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:gn.RED,this.left=null!=r?r:gn.EMPTY,this.right=null!=s?s:gn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new gn(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return gn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return gn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,gn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,gn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw R(43730,{key:this.key,value:this.value});if(this.right.isRed())throw R(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw R(27949);return e+(this.isRed()?0:1)}}gn.EMPTY=null,gn.RED=!0,gn.BLACK=!1,gn.EMPTY=new class{constructor(){this.size=0}get key(){throw R(57766)}get value(){throw R(16141)}get color(){throw R(16727)}get left(){throw R(29726)}get right(){throw R(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new gn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class mn{constructor(e){this.comparator=e,this.data=new dn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pn(this.data.getIterator())}getIteratorFrom(e){return new pn(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof mn))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new mn(this.comparator);return t.data=e,t}}class pn{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function yn(e){return e.hasNext()?e.getNext():void 0}class vn{constructor(e){this.fields=e,e.sort(de.comparator)}static empty(){return new vn([])}unionWith(e){let t=new mn(de.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new vn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ne(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class wn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function bn(){return"undefined"!=typeof atob}class In{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new wn("Invalid base64 string: "+e):e}}(e);return new In(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new In(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}In.EMPTY_BYTE_STRING=new In("");const En=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _n(e){if(M(!!e,39018),"string"==typeof e){let t=0;const n=En.exec(e);if(M(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Tn(e.seconds),nanos:Tn(e.nanos)}}function Tn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Sn(e){return"string"==typeof e?In.fromBase64String(e):In.fromUint8Array(e)}const Cn="server_timestamp",xn="__type__",An="__previous_value__",Dn="__local_write_time__";function Nn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[xn])||void 0===n?void 0:n.stringValue)===Cn}function kn(e){const t=e.mapValue.fields[An];return Nn(t)?kn(t):t}function Rn(e){const t=_n(e.mapValue.fields[Dn].timestampValue);return new oe(t.seconds,t.nanos)}class On{constructor(e,t,n,r,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Mn="(default)";class Pn{constructor(e,t){this.projectId=e,this.database=t||Mn}static empty(){return new Pn("","")}get isDefaultDatabase(){return this.database===Mn}isEqual(e){return e instanceof Pn&&e.projectId===this.projectId&&e.database===this.database}}const Ln="__type__",Fn="__max__",Vn={mapValue:{fields:{__type__:{stringValue:Fn}}}},Bn="__vector__",Un="value",qn={nullValue:"NULL_VALUE"};function zn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Nn(e)?4:ir(e)?9007199254740991:rr(e)?10:11:R(28295,{value:e})}function jn(e,t){if(e===t)return!0;const n=zn(e);if(n!==zn(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Rn(e).isEqual(Rn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=_n(e.timestampValue),r=_n(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Sn(e.bytesValue).isEqual(Sn(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Tn(e.geoPointValue.latitude)===Tn(t.geoPointValue.latitude)&&Tn(e.geoPointValue.longitude)===Tn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Tn(e.integerValue)===Tn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Tn(e.doubleValue),r=Tn(t.doubleValue);return n===r?Qe(n)===Qe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ne(e.arrayValue.values||[],t.arrayValue.values||[],jn);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(cn(n)!==cn(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!jn(n[e],r[e])))return!1;return!0}(e,t);default:return R(52216,{left:e})}}function $n(e,t){return void 0!==(e.values||[]).find((e=>jn(e,t)))}function Kn(e,t){if(e===t)return 0;const n=zn(e),r=zn(t);if(n!==r)return J(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return J(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Tn(e.integerValue||e.doubleValue),r=Tn(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Gn(e.timestampValue,t.timestampValue);case 4:return Gn(Rn(e),Rn(t));case 5:return Z(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Sn(e),r=Sn(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=J(n[e],r[e]);if(0!==t)return t}return J(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=J(Tn(e.latitude),Tn(t.latitude));return 0!==n?n:J(Tn(e.longitude),Tn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Qn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,s,i;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Un])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Un])||void 0===r?void 0:r.arrayValue,h=J((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0);return 0!==h?h:Qn(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Vn.mapValue&&t===Vn.mapValue)return 0;if(e===Vn.mapValue)return 1;if(t===Vn.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=Z(r[e],i[e]);if(0!==t)return t;const o=Kn(n[r[e]],s[i[e]]);if(0!==o)return o}return J(r.length,i.length)}(e.mapValue,t.mapValue);default:throw R(23264,{Pe:n})}}function Gn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return J(e,t);const n=_n(e),r=_n(t),s=J(n.seconds,r.seconds);return 0!==s?s:J(n.nanos,r.nanos)}function Qn(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Kn(n[e],r[e]);if(t)return t}return J(n.length,r.length)}function Hn(e){return Wn(e)}function Wn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=_n(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Sn(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return fe.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Wn(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${Wn(e.fields[s])}`;return n+"}"}(e.mapValue):R(61005,{value:e})}function Xn(e){switch(zn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=kn(e);return t?16+Xn(t):16;case 5:return 2*e.stringValue.length;case 6:return Sn(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Xn(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return un(e.fields,((e,n)=>{t+=e.length+Xn(n)})),t}(e.mapValue);default:throw R(13486,{value:e})}}function Yn(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Jn(e){return!!e&&"integerValue"in e}function Zn(e){return!!e&&"arrayValue"in e}function er(e){return!!e&&"nullValue"in e}function tr(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nr(e){return!!e&&"mapValue"in e}function rr(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Ln])||void 0===n?void 0:n.stringValue)===Bn}function sr(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return un(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=sr(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=sr(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ir(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Fn}const or={mapValue:{fields:{[Ln]:{stringValue:Bn},[Un]:{arrayValue:{}}}}};function ar(e){return"nullValue"in e?qn:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Yn(Pn.empty(),fe.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?rr(e)?or:{mapValue:{}}:R(35942,{value:e})}function cr(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Yn(Pn.empty(),fe.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?or:"mapValue"in e?rr(e)?{mapValue:{}}:Vn:R(61959,{value:e})}function ur(e,t){const n=Kn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function hr(e,t){const n=Kn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class lr{constructor(e){this.value=e}static empty(){return new lr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!nr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sr(t)}setAll(e){let t=de.emptyPath(),n={},r=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=sr(e):r.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());nr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return jn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){un(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new lr(sr(this.value))}}function dr(e){const t=[];return un(e.fields,((e,n)=>{const r=new de([e]);if(nr(n)){const e=dr(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new vn(t)}class fr{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new fr(e,0,ae.min(),ae.min(),ae.min(),lr.empty(),0)}static newFoundDocument(e,t,n,r){return new fr(e,1,t,ae.min(),n,r,0)}static newNoDocument(e,t){return new fr(e,2,t,ae.min(),ae.min(),lr.empty(),0)}static newUnknownDocument(e,t){return new fr(e,3,t,ae.min(),ae.min(),lr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ae.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof fr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new fr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class gr{constructor(e,t){this.position=e,this.inclusive=t}}function mr(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?fe.comparator(fe.fromName(o.referenceValue),n.key):Kn(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function pr(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!jn(e.position[n],t.position[n]))return!1;return!0}class yr{constructor(e,t="asc"){this.field=e,this.dir=t}}function vr(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class wr{}class br extends wr{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Nr(e,t,n):"array-contains"===t?new Mr(e,n):"in"===t?new Pr(e,n):"not-in"===t?new Lr(e,n):"array-contains-any"===t?new Fr(e,n):new br(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new kr(e,n):new Rr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Kn(t,this.value)):null!==t&&zn(this.value)===zn(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return R(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ir extends wr{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new Ir(e,t)}matches(e){return Er(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function Er(e){return"and"===e.op}function _r(e){return"or"===e.op}function Tr(e){return Sr(e)&&Er(e)}function Sr(e){for(const t of e.filters)if(t instanceof Ir)return!1;return!0}function Cr(e){if(e instanceof br)return e.field.canonicalString()+e.op.toString()+Hn(e.value);if(Tr(e))return e.filters.map((e=>Cr(e))).join(",");{const t=e.filters.map((e=>Cr(e))).join(",");return`${e.op}(${t})`}}function xr(e,t){return e instanceof br?function(e,t){return t instanceof br&&e.op===t.op&&e.field.isEqual(t.field)&&jn(e.value,t.value)}(e,t):e instanceof Ir?function(e,t){return t instanceof Ir&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&xr(n,t.filters[r])),!0)}(e,t):void R(19439)}function Ar(e,t){const n=e.filters.concat(t);return Ir.create(n,e.op)}function Dr(e){return e instanceof br?function(e){return`${e.field.canonicalString()} ${e.op} ${Hn(e.value)}`}(e):e instanceof Ir?function(e){return e.op.toString()+" {"+e.getFilters().map(Dr).join(" ,")+"}"}(e):"Filter"}class Nr extends br{constructor(e,t,n){super(e,t,n),this.key=fe.fromName(n.referenceValue)}matches(e){const t=fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class kr extends br{constructor(e,t){super(e,"in",t),this.keys=Or(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Rr extends br{constructor(e,t){super(e,"not-in",t),this.keys=Or(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Or(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>fe.fromName(e.referenceValue)))}class Mr extends br{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Zn(t)&&$n(t.arrayValue,this.value)}}class Pr extends br{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&$n(this.value.arrayValue,t)}}class Lr extends br{constructor(e,t){super(e,"not-in",t)}matches(e){if($n(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!$n(this.value.arrayValue,t)}}class Fr extends br{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zn(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>$n(this.value.arrayValue,e)))}}class Vr{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Ie=null}}function Br(e,t=null,n=[],r=[],s=null,i=null,o=null){return new Vr(e,t,n,r,s,i,o)}function Ur(e){const t=L(e);if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Cr(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ge(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Hn(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Hn(e))).join(",")),t.Ie=e}return t.Ie}function qr(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!vr(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!xr(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!pr(e.startAt,t.startAt)&&pr(e.endAt,t.endAt)}function zr(e){return fe.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function jr(e,t){return e.filters.filter((e=>e instanceof br&&e.field.isEqual(t)))}function $r(e,t,n){let r=qn,s=!0;for(const n of jr(e,t)){let e=qn,t=!0;switch(n.op){case"<":case"<=":e=ar(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=qn}ur({value:r,inclusive:s},{value:e,inclusive:t})<0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];ur({value:r,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}function Kr(e,t,n){let r=Vn,s=!0;for(const n of jr(e,t)){let e=Vn,t=!0;switch(n.op){case">=":case">":e=cr(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Vn}hr({value:r,inclusive:s},{value:e,inclusive:t})>0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];hr({value:r,inclusive:s},{value:e,inclusive:n.inclusive})>0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}class Gr{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Qr(e,t,n,r,s,i,o,a){return new Gr(e,t,n,r,s,i,o,a)}function Hr(e){return new Gr(e)}function Wr(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Xr(e){return null!==e.collectionGroup}function Yr(e){const t=L(e);if(null===t.Ee){t.Ee=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ee.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new mn(de.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ee.push(new yr(r,n))})),e.has(de.keyField().canonicalString())||t.Ee.push(new yr(de.keyField(),n))}return t.Ee}function Jr(e){const t=L(e);return t.de||(t.de=es(t,Yr(e))),t.de}function Zr(e){const t=L(e);return t.Ae||(t.Ae=es(t,e.explicitOrderBy)),t.Ae}function es(e,t){if("F"===e.limitType)return Br(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new yr(e.field,t)}));const n=e.endAt?new gr(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new gr(e.startAt.position,e.startAt.inclusive):null;return Br(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ts(e,t){const n=e.filters.concat([t]);return new Gr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function ns(e,t,n){return new Gr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rs(e,t){return qr(Jr(e),Jr(t))&&e.limitType===t.limitType}function ss(e){return`${Ur(Jr(e))}|lt:${e.limitType}`}function is(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Dr(e))).join(", ")}]`),Ge(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Hn(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Hn(e))).join(",")),`Target(${t})`}(Jr(e))}; limitType=${e.limitType})`}function os(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):fe.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Yr(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=mr(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Yr(e),t)||e.endAt&&!function(e,t,n){const r=mr(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Yr(e),t))}(e,t)}function as(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function cs(e){return(t,n)=>{let r=!1;for(const s of Yr(e)){const e=us(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function us(e,t,n){const r=e.field.isKeyField()?fe.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?Kn(r,s):R(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return R(19790,{direction:e.dir})}}class hs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){un(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return ln(this.inner)}size(){return this.innerSize}}const ls=new dn(fe.comparator);function ds(){return ls}const fs=new dn(fe.comparator);function gs(...e){let t=fs;for(const n of e)t=t.insert(n.key,n);return t}function ms(e){let t=fs;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ps(){return vs()}function ys(){return vs()}function vs(){return new hs((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ws=new dn(fe.comparator),bs=new mn(fe.comparator);function Is(...e){let t=bs;for(const n of e)t=t.add(n);return t}const Es=new mn(J);function _s(){return Es}function Ts(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qe(t)?"-0":t}}function Ss(e){return{integerValue:""+e}}function Cs(e,t){return He(t)?Ss(t):Ts(e,t)}class xs{constructor(){this._=void 0}}function As(e,t,n){return e instanceof ks?function(e,t){const n={fields:{[xn]:{stringValue:Cn},[Dn]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Nn(t)&&(t=kn(t)),t&&(n.fields[An]=t),{mapValue:n}}(n,t):e instanceof Rs?Os(e,t):e instanceof Ms?Ps(e,t):function(e,t){const n=Ns(e,t),r=Fs(n)+Fs(e.Re);return Jn(n)&&Jn(e.Re)?Ss(r):Ts(e.serializer,r)}(e,t)}function Ds(e,t,n){return e instanceof Rs?Os(e,t):e instanceof Ms?Ps(e,t):n}function Ns(e,t){return e instanceof Ls?function(e){return Jn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class ks extends xs{}class Rs extends xs{constructor(e){super(),this.elements=e}}function Os(e,t){const n=Vs(t);for(const t of e.elements)n.some((e=>jn(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Ms extends xs{constructor(e){super(),this.elements=e}}function Ps(e,t){let n=Vs(t);for(const t of e.elements)n=n.filter((e=>!jn(e,t)));return{arrayValue:{values:n}}}class Ls extends xs{constructor(e,t){super(),this.serializer=e,this.Re=t}}function Fs(e){return Tn(e.integerValue||e.doubleValue)}function Vs(e){return Zn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Bs{constructor(e,t){this.field=e,this.transform=t}}class Us{constructor(e,t){this.version=e,this.transformResults=t}}class qs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qs}static exists(e){return new qs(void 0,e)}static updateTime(e){return new qs(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function zs(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class js{}function $s(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ei(e.key,qs.none()):new Ws(e.key,e.data,qs.none());{const n=e.data,r=lr.empty();let s=new mn(de.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new Xs(e.key,r,new vn(s.toArray()),qs.none())}}function Ks(e,t,n){e instanceof Ws?function(e,t,n){const r=e.value.clone(),s=Js(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Xs?function(e,t,n){if(!zs(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Js(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Ys(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Gs(e,t,n,r){return e instanceof Ws?function(e,t,n,r){if(!zs(e.precondition,t))return n;const s=e.value.clone(),i=Zs(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof Xs?function(e,t,n,r){if(!zs(e.precondition,t))return n;const s=Zs(e.fieldTransforms,r,t),i=t.data;return i.setAll(Ys(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return zs(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Qs(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Ns(r.transform,e||null);null!=s&&(null===n&&(n=lr.empty()),n.set(r.field,s))}return n||null}function Hs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ne(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Rs&&t instanceof Rs||e instanceof Ms&&t instanceof Ms?ne(e.elements,t.elements,jn):e instanceof Ls&&t instanceof Ls?jn(e.Re,t.Re):e instanceof ks&&t instanceof ks}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ws extends js{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Xs extends js{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ys(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Js(e,t,n){const r=new Map;M(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Ds(o,a,n[s]))}return r}function Zs(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,As(e,i,t))}return r}class ei extends js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ti extends js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ni{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Ks(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Gs(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Gs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ys();return this.mutations.forEach((r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=$s(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(ae.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Is())}isEqual(e){return this.batchId===e.batchId&&ne(this.mutations,e.mutations,((e,t)=>Hs(e,t)))&&ne(this.baseMutations,e.baseMutations,((e,t)=>Hs(e,t)))}}class ri{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){M(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let r=ws;const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new ri(e,t,n,r)}}class si{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ii{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class oi{constructor(e,t){this.count=e,this.unchangedNames=t}}var ai,ci;function ui(e){switch(e){case F.OK:return R(64938);case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0;default:return R(15467,{code:e})}}function hi(e){if(void 0===e)return D("GRPC error has no .code"),F.UNKNOWN;switch(e){case ai.OK:return F.OK;case ai.CANCELLED:return F.CANCELLED;case ai.UNKNOWN:return F.UNKNOWN;case ai.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case ai.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case ai.INTERNAL:return F.INTERNAL;case ai.UNAVAILABLE:return F.UNAVAILABLE;case ai.UNAUTHENTICATED:return F.UNAUTHENTICATED;case ai.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case ai.NOT_FOUND:return F.NOT_FOUND;case ai.ALREADY_EXISTS:return F.ALREADY_EXISTS;case ai.PERMISSION_DENIED:return F.PERMISSION_DENIED;case ai.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case ai.ABORTED:return F.ABORTED;case ai.OUT_OF_RANGE:return F.OUT_OF_RANGE;case ai.UNIMPLEMENTED:return F.UNIMPLEMENTED;case ai.DATA_LOSS:return F.DATA_LOSS;default:return R(39323,{code:e})}}(ci=ai||(ai={}))[ci.OK=0]="OK",ci[ci.CANCELLED=1]="CANCELLED",ci[ci.UNKNOWN=2]="UNKNOWN",ci[ci.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ci[ci.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ci[ci.NOT_FOUND=5]="NOT_FOUND",ci[ci.ALREADY_EXISTS=6]="ALREADY_EXISTS",ci[ci.PERMISSION_DENIED=7]="PERMISSION_DENIED",ci[ci.UNAUTHENTICATED=16]="UNAUTHENTICATED",ci[ci.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ci[ci.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ci[ci.ABORTED=10]="ABORTED",ci[ci.OUT_OF_RANGE=11]="OUT_OF_RANGE",ci[ci.UNIMPLEMENTED=12]="UNIMPLEMENTED",ci[ci.INTERNAL=13]="INTERNAL",ci[ci.UNAVAILABLE=14]="UNAVAILABLE",ci[ci.DATA_LOSS=15]="DATA_LOSS";let li=null;const di=new r([4294967295,4294967295],0);function fi(e){const t=X().encode(e),n=new s;return n.update(t),new Uint8Array(n.digest())}function gi(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new r([n,s],0),new r([i,o],0)]}class mi{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new pi(`Invalid padding: ${t}`);if(n<0)throw new pi(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new pi(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new pi(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=r.fromNumber(this.pe)}we(e,t,n){let s=e.add(t.multiply(r.fromNumber(n)));return 1===s.compare(di)&&(s=new r([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;const t=fi(e),[n,r]=gi(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);if(!this.be(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new mi(s,r,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.pe)return;const t=fi(e),[n,r]=gi(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class pi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class yi{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,vi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new yi(ae.min(),r,new dn(J),ds(),Is())}}class vi{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vi(n,t,Is(),Is(),Is())}}class wi{constructor(e,t,n,r){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=r}}class bi{constructor(e,t){this.targetId=e,this.Ce=t}}class Ii{constructor(e,t,n=In.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ei{constructor(){this.Fe=0,this.Me=Si(),this.xe=In.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Is(),t=Is(),n=Is();return this.Me.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:R(38017,{changeType:s})}})),new vi(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=Si()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,M(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class _i{constructor(e){this.ze=e,this.je=new Map,this.He=ds(),this.Je=Ti(),this.Ye=Ti(),this.Ze=new dn(J)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,(t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:R(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach(((e,n)=>{this.it(n)&&t(n)}))}ot(e){const t=e.targetId,n=e.Ce.count,r=this._t(t);if(r){const s=r.target;if(zr(s))if(0===n){const e=new fe(s.path);this.tt(t,e,fr.newNoDocument(e,ae.min()))}else M(1===n,20013,{expectedCount:n});else{const r=this.ut(t);if(r!==n){const n=this.ct(e),s=n?this.lt(n,e,r):1;if(0!==s){this.st(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}null==li||li.ht(function(e,t,n,r,s){var i,o,a,c,u,h;const l={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(l.bloomFilter={applied:0===s,hashCount:null!==(i=null==d?void 0:d.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(h=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),l}(r,e.Ce,this.ze.Pt(),n,s))}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=Sn(n).toUint8Array()}catch(e){if(e instanceof wn)return N("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new mi(i,r,s)}catch(e){return N(e instanceof pi?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.pe?null:o}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const s=this.ze.Pt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.tt(t,n,null),r++)})),r}It(e){const t=new Map;this.je.forEach(((n,r)=>{const s=this._t(r);if(s){if(n.current&&zr(s.target)){const t=new fe(s.target.path);this.Et(t).has(r)||this.dt(r,t)||this.tt(r,t,fr.newNoDocument(t,e))}n.Le&&(t.set(r,n.qe()),n.Qe())}}));let n=Is();this.Ye.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.He.forEach(((t,n)=>n.setReadTime(e)));const r=new yi(e,t,this.Ze,this.He,n);return this.He=ds(),this.Je=Ti(),this.Ye=Ti(),this.Ze=new dn(J),r}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Ei,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new mn(J),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new mn(J),this.Je=this.Je.insert(e,t)),t}it(e){const t=null!==this._t(e);return t||A("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Ei),this.ze.getRemoteKeysForTarget(e).forEach((t=>{this.tt(e,t,null)}))}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Ti(){return new dn(fe.comparator)}function Si(){return new dn(fe.comparator)}const Ci={asc:"ASCENDING",desc:"DESCENDING"},xi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ai={and:"AND",or:"OR"};class Di{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ni(e,t){return e.useProto3Json||Ge(t)?t:{value:t}}function ki(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ri(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Oi(e,t){return ki(e,t.toTimestamp())}function Mi(e){return M(!!e,49232),ae.fromTimestamp(function(e){const t=_n(e);return new oe(t.seconds,t.nanos)}(e))}function Pi(e,t){return Li(e,t).canonicalString()}function Li(e,t){const n=function(e){return new he(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Fi(e){const t=he.fromString(e);return M(oo(t),10190,{key:t.toString()}),t}function Vi(e,t){return Pi(e.databaseId,t.path)}function Bi(e,t){const n=Fi(t);if(n.get(1)!==e.databaseId.projectId)throw new V(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new V(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new fe(ji(n))}function Ui(e,t){return Pi(e.databaseId,t)}function qi(e){const t=Fi(e);return 4===t.length?he.emptyPath():ji(t)}function zi(e){return new he(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ji(e){return M(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function $i(e,t,n){return{name:Vi(e,t),fields:n.value.mapValue.fields}}function Ki(e,t,n){const r=Bi(e,t.name),s=Mi(t.updateTime),i=t.createTime?Mi(t.createTime):ae.min(),o=new lr({mapValue:{fields:t.fields}}),a=fr.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Gi(e,t){let n;if(t instanceof Ws)n={update:$i(e,t.key,t.value)};else if(t instanceof ei)n={delete:Vi(e,t.key)};else if(t instanceof Xs)n={update:$i(e,t.key,t.data),updateMask:io(t.fieldMask)};else{if(!(t instanceof ti))return R(16599,{ft:t.type});n={verify:Vi(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof ks)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ms)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ls)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw R(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Oi(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:R(27497)}(e,t.precondition)),n}function Qi(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?qs.updateTime(Mi(e.updateTime)):void 0!==e.exists?qs.exists(e.exists):qs.none()}(t.currentDocument):qs.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)M("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new ks;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Rs(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ms(e)}else"increment"in t?n=new Ls(e,t.increment):R(16584,{proto:t});const r=de.fromServerFormat(t.fieldPath);return new Bs(r,n)}(e,t))):[];if(t.update){t.update.name;const s=Bi(e,t.update.name),i=new lr({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new vn(t.map((e=>de.fromServerFormat(e))))}(t.updateMask);return new Xs(s,i,e,n,r)}return new Ws(s,i,n,r)}if(t.delete){const r=Bi(e,t.delete);return new ei(r,n)}if(t.verify){const r=Bi(e,t.verify);return new ti(r,n)}return R(1463,{proto:t})}function Hi(e,t){return{documents:[Ui(e,t.path)]}}function Wi(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ui(e,s);const i=function(e){if(0!==e.length)return so(Ir.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:no(e.field),direction:Zi(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ni(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{gt:n,parent:s}}function Xi(e,t,n,r){const{gt:s,parent:i}=Wi(e,t),o={},a=[];let c=0;return n.forEach((e=>{const t=r?e.alias:"aggregate_"+c++;o[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:no(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:no(e.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},yt:o,parent:i}}function Yi(e){let t=qi(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){M(1===r,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=Ji(e);return t instanceof Ir&&Tr(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new yr(ro(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ge(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new gr(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new gr(n,t)}(n.endAt)),Qr(t,s,o,i,a,"F",c,u)}function Ji(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ro(e.unaryFilter.field);return br.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ro(e.unaryFilter.field);return br.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ro(e.unaryFilter.field);return br.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ro(e.unaryFilter.field);return br.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return R(61313);default:return R(60726)}}(e):void 0!==e.fieldFilter?function(e){return br.create(ro(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return R(58110);default:return R(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Ir.create(e.compositeFilter.filters.map((e=>Ji(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return R(1026)}}(e.compositeFilter.op))}(e):R(30097,{filter:e})}function Zi(e){return Ci[e]}function eo(e){return xi[e]}function to(e){return Ai[e]}function no(e){return{fieldPath:e.canonicalString()}}function ro(e){return de.fromServerFormat(e.fieldPath)}function so(e){return e instanceof br?function(e){if("=="===e.op){if(tr(e.value))return{unaryFilter:{field:no(e.field),op:"IS_NAN"}};if(er(e.value))return{unaryFilter:{field:no(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(tr(e.value))return{unaryFilter:{field:no(e.field),op:"IS_NOT_NAN"}};if(er(e.value))return{unaryFilter:{field:no(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:no(e.field),op:eo(e.op),value:e.value}}}(e):e instanceof Ir?function(e){const t=e.getFilters().map((e=>so(e)));return 1===t.length?t[0]:{compositeFilter:{op:to(e.op),filters:t}}}(e):R(54877,{filter:e})}function io(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function oo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class ao{constructor(e,t,n,r,s=ae.min(),i=ae.min(),o=In.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new ao(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ao(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ao(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ao(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class co{constructor(e){this.wt=e}}function uo(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:ho(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Vi(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ki(e,t.version.toTimestamp()),createTime:ki(e,t.createTime.toTimestamp())}}(e.wt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:lo(t.version)};else{if(!t.isUnknownDocument())return R(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:lo(t.version)}}return r}function ho(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function lo(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function fo(e){const t=new oe(e.seconds,e.nanoseconds);return ae.fromTimestamp(t)}function go(e,t){const n=(t.baseMutations||[]).map((t=>Qi(e.wt,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Qi(e.wt,t))),s=oe.fromMillis(t.localWriteTimeMs);return new ni(t.batchId,s,n,r)}function mo(e){const t=fo(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?fo(e.lastLimboFreeSnapshotVersion):ae.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){const t=e.documents.length;return M(1===t,1966,{count:t}),Jr(Hr(qi(e.documents[0])))}(e.query):function(e){return Jr(Yi(e))}(e.query),new ao(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,In.fromBase64String(e.resumeToken))}function po(e,t){const n=lo(t.snapshotVersion),r=lo(t.lastLimboFreeSnapshotVersion);let s;s=zr(t.target)?Hi(e.wt,t.target):Wi(e.wt,t.target).gt;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ur(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function yo(e){const t=Yi({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ns(t,t.limit,"L"):t}function vo(e,t){return new si(t.largestBatchId,Qi(e.wt,t.overlayMutation))}function wo(e,t){const n=t.path.lastSegment();return[e,Xe(t.path.popLast()),n]}function bo(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:lo(r.readTime),documentKey:Xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class Io{getBundleMetadata(e,t){return Eo(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:fo(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return Eo(e).put(function(e){return{bundleId:e.id,createTime:lo(Mi(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return _o(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:yo(e.bundledQuery),readTime:fo(e.readTime)}}(e)}))}saveNamedQuery(e,t){return _o(e).put(function(e){return{name:e.name,readTime:lo(Mi(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Eo(e){return an(e,Rt)}function _o(e){return an(e,Ot)}class To{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){const n=t.uid||"";return new To(e,n)}getOverlay(e,t){return So(e).get(wo(this.userId,t)).next((e=>e?vo(this.serializer,e):null))}getOverlays(e,t){const n=ps();return De.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,s)=>{const i=new si(t,s);r.push(this.St(e,i))})),De.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Xe(e.getCollectionPath()))));const s=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);s.push(So(e).X(Gt,r))})),De.waitFor(s)}getOverlaysForCollection(e,t,n){const r=ps(),s=Xe(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return So(e).J(Gt,i).next((e=>{for(const t of e){const e=vo(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const s=ps();let i;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return So(e).te({index:Ht,range:o},((e,t,n)=>{const o=vo(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>s))}St(e,t){return So(e).put(function(e,t,n){const[r,s,i]=wo(t,n.mutation.key);return{userId:t,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Gi(e.wt,n.mutation)}}(this.serializer,this.userId,t))}}function So(e){return an(e,$t)}class Co{Dt(e){return an(e,Xt)}getSessionToken(e){return this.Dt(e).get("sessionToken").next((e=>{const t=null==e?void 0:e.value;return t?In.fromUint8Array(t):In.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class xo{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(Tn(e.integerValue));else if("doubleValue"in e){const n=Tn(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),Qe(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=_n(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(Sn(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?ir(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):rr(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):R(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const n=e.fields||{};this.Mt(t,55);for(const e of Object.keys(n))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;const s=e.fields||{};this.Mt(t,53);const i=Un,o=(null===(r=null===(n=s[i].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(t,15),t.xt(Tn(o)),this.Nt(i,t),this.Ct(s[i],t)}$t(e,t){const n=e.values||[];this.Mt(t,50);for(const e of n)this.Ct(e,t)}kt(e,t){this.Mt(t,37),fe.fromName(e).path.forEach((e=>{this.Mt(t,60),this.Kt(e,t)}))}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}xo.Wt=new xo;const Ao=255;function Do(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function No(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Do(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class ko{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{const e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{const e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){const t=this.tn(e),n=No(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}rn(e){const t=this.tn(e),n=No(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}sn(){this._n(Ao),this._n(255)}an(){this.un(Ao),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}zt(e){const t=255&e;0===t?(this._n(0),this._n(255)):t===Ao?(this._n(Ao),this._n(0)):this._n(t)}Jt(e){const t=255&e;0===t?(this.un(0),this.un(255)):t===Ao?(this.un(Ao),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Ro{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class Oo{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class Mo{constructor(){this.ln=new ko,this.hn=new Ro(this.ln),this.Pn=new Oo(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class Po{constructor(e,t,n,r){this.In=e,this.En=t,this.dn=n,this.An=r}Rn(){const e=this.An.length,t=0===e||255===this.An[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.An,0),t!==e?n.set([0],this.An.length):++n[n.length-1],new Po(this.In,this.En,this.dn,n)}Vn(e,t,n){return{indexId:this.In,uid:e,arrayValue:Vo(this.dn),directionalValue:Vo(this.An),orderedDocumentKey:Vo(t),documentKey:n.path.toArray()}}mn(e,t,n){const r=this.Vn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Lo(e,t){let n=e.In-t.In;return 0!==n?n:(n=Fo(e.dn,t.dn),0!==n?n:(n=Fo(e.An,t.An),0!==n?n:fe.comparator(e.En,t.En)))}function Fo(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function Vo(e){return(0,c.Ov)()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function Bo(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class Uo{constructor(e){this.fn=new mn(((e,t)=>de.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.gn=e.orderBy,this.pn=[];for(const t of e.filters){const e=t;e.isInequality()?this.fn=this.fn.add(e):this.pn.push(e)}}get yn(){return this.fn.size>1}wn(e){if(M(e.collectionGroup===this.collectionId,49279),this.yn)return!1;const t=pe(e);if(void 0!==t&&!this.bn(t))return!1;const n=ye(e);let r=new Set,s=0,i=0;for(;s<n.length&&this.bn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.fn.size>0){const e=this.fn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[s];if(!this.Sn(e,t)||!this.Dn(this.gn[i++],t))return!1}++s}for(;s<n.length;++s){const e=n[s];if(i>=this.gn.length||!this.Dn(this.gn[i++],e))return!1}return!0}vn(){if(this.yn)return null;let e=new mn(de.comparator);const t=[];for(const n of this.pn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new we(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new we(n.field,0))}for(const n of this.gn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new we(n.field,"asc"===n.dir?0:1)));return new me(me.UNKNOWN_ID,this.collectionId,t,Ie.empty())}bn(e){for(const t of this.pn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Dn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function qo(e){var t,n;if(M(e instanceof br||e instanceof Ir,20012),e instanceof br){if(e instanceof Pr){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>br.create(e.field,"==",t))))||[];return Ir.create(r,"or")}return e}const r=e.filters.map((e=>qo(e)));return Ir.create(r,e.op)}function zo(e){if(0===e.getFilters().length)return[];const t=Go(qo(e));return M(Ko(t),7391),jo(t)||$o(t)?[t]:t.getFilters()}function jo(e){return e instanceof br}function $o(e){return e instanceof Ir&&Tr(e)}function Ko(e){return jo(e)||$o(e)||function(e){if(e instanceof Ir&&_r(e)){for(const t of e.getFilters())if(!jo(t)&&!$o(t))return!1;return!0}return!1}(e)}function Go(e){if(M(e instanceof br||e instanceof Ir,34018),e instanceof br)return e;if(1===e.filters.length)return Go(e.filters[0]);const t=e.filters.map((e=>Go(e)));let n=Ir.create(t,e.op);return n=Wo(n),Ko(n)?n:(M(n instanceof Ir,64498),M(Er(n),40251),M(n.filters.length>1,57927),n.filters.reduce(((e,t)=>Qo(e,t))))}function Qo(e,t){let n;return M(e instanceof br||e instanceof Ir,38388),M(t instanceof br||t instanceof Ir,25473),n=e instanceof br?t instanceof br?function(e,t){return Ir.create([e,t],"and")}(e,t):Ho(e,t):t instanceof br?Ho(t,e):function(e,t){if(M(e.filters.length>0&&t.filters.length>0,48005),Er(e)&&Er(t))return Ar(e,t.getFilters());const n=_r(e)?e:t,r=_r(e)?t:e,s=n.filters.map((e=>Qo(e,r)));return Ir.create(s,"or")}(e,t),Wo(n)}function Ho(e,t){if(Er(t))return Ar(t,e.getFilters());{const n=t.filters.map((t=>Qo(e,t)));return Ir.create(n,"or")}}function Wo(e){if(M(e instanceof br||e instanceof Ir,11850),e instanceof br)return e;const t=e.getFilters();if(1===t.length)return Wo(t[0]);if(Sr(e))return e;const n=t.map((e=>Wo(e))),r=[];return n.forEach((t=>{t instanceof br?r.push(t):t instanceof Ir&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:Ir.create(r,e.op)}class Xo{constructor(){this.Cn=new Yo}addToCollectionParentIndex(e,t){return this.Cn.add(t),De.resolve()}getCollectionParents(e,t){return De.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return De.resolve()}deleteFieldIndex(e,t){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,t){return De.resolve()}getDocumentsMatchingTarget(e,t){return De.resolve(null)}getIndexType(e,t){return De.resolve(0)}getFieldIndexes(e,t){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,t){return De.resolve(Te.min())}getMinOffsetFromCollectionGroup(e,t){return De.resolve(Te.min())}updateCollectionGroup(e,t,n){return De.resolve()}updateIndexEntries(e,t){return De.resolve()}}class Yo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new mn(he.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new mn(he.comparator)).toArray()}}const Jo="IndexedDbIndexManager",Zo=new Uint8Array(0);class ea{constructor(e,t){this.databaseId=t,this.Fn=new Yo,this.Mn=new hs((e=>Ur(e)),((e,t)=>qr(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Fn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Fn.add(t)}));const s={collectionId:n,parent:Xe(r)};return ta(e).put(s)}return De.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[re(t),""],!1,!0);return ta(e).J(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ze(r.parent))}return n}))}addFieldIndex(e,t){const n=ra(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const s=n.add(r);if(t.indexState){const n=sa(e);return s.next((e=>{n.put(bo(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return s.next()}deleteFieldIndex(e,t){const n=ra(e),r=sa(e),s=na(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=ra(e),n=na(e),r=sa(e);return t.X().next((()=>n.X())).next((()=>r.X()))}createTargetIndexes(e,t){return De.forEach(this.xn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new Uo(t).vn();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=na(e);let r=!0;const s=new Map;return De.forEach(this.xn(t),(t=>this.On(e,t).next((e=>{r&&(r=!!e),s.set(t,e)})))).next((()=>{if(r){let e=Is();const r=[];return De.forEach(s,((s,i)=>{A(Jo,`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(s)} to execute ${Ur(t)}`);const o=function(e,t){const n=pe(t);if(void 0===n)return null;for(const t of jr(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(i,s),a=function(e,t){const n=new Map;for(const r of ye(t))for(const t of jr(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(i,s),c=function(e,t){const n=[];let r=!0;for(const s of ye(t)){const t=0===s.kind?$r(e,s.fieldPath,e.startAt):Kr(e,s.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new gr(n,r)}(i,s),u=function(e,t){const n=[];let r=!0;for(const s of ye(t)){const t=0===s.kind?Kr(e,s.fieldPath,e.endAt):$r(e,s.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new gr(n,r)}(i,s),h=this.Nn(s,i,c),l=this.Nn(s,i,u),d=this.Bn(s,i,a),f=this.Ln(s.indexId,o,h,c.inclusive,l,u.inclusive,d);return De.forEach(f,(s=>n.Z(s,t.limit).next((t=>{t.forEach((t=>{const n=fe.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return De.resolve(null)}))}xn(e){let t=this.Mn.get(e);return t||(t=0===e.filters.length?[e]:zo(Ir.create(e.filters,"and")).map((t=>Br(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.Mn.set(e,t),t)}Ln(e,t,n,r,s,i,o){const a=(null!=t?t.length:1)*Math.max(n.length,s.length),c=a/(null!=t?t.length:1),u=[];for(let h=0;h<a;++h){const a=t?this.kn(t[h/c]):Zo,l=this.qn(e,a,n[h%c],r),d=this.Qn(e,a,s[h%c],i),f=o.map((t=>this.qn(e,a,t,!0)));u.push(...this.createRange(l,d,f))}return u}qn(e,t,n,r){const s=new Po(e,fe.empty(),t,n);return r?s:s.Rn()}Qn(e,t,n,r){const s=new Po(e,fe.empty(),t,n);return r?s.Rn():s}On(e,t){const n=new Uo(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.wn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.xn(t);return De.forEach(r,(t=>this.On(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new mn(de.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}$n(e,t){const n=new Mo;for(const r of ye(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const s=n.Tn(r.kind);xo.Wt.vt(e,s)}return n.cn()}kn(e){const t=new Mo;return xo.Wt.vt(e,t.Tn(0)),t.cn()}Un(e,t){const n=new Mo;return xo.Wt.vt(Yn(this.databaseId,t),n.Tn(function(e){const t=ye(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.cn()}Bn(e,t,n){if(null===n)return[];let r=[];r.push(new Mo);let s=0;for(const i of ye(e)){const e=n[s++];for(const n of r)if(this.Kn(t,i.fieldPath)&&Zn(e))r=this.Wn(r,i,e);else{const t=n.Tn(i.kind);xo.Wt.vt(e,t)}}return this.Gn(r)}Nn(e,t,n){return this.Bn(e,t,n.position)}Gn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}Wn(e,t,n){const r=[...e],s=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Mo;r.seed(n.cn()),xo.Wt.vt(e,r.Tn(t.kind)),s.push(r)}return s}Kn(e,t){return!!e.filters.find((e=>e instanceof br&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=ra(e),r=sa(e);return(t?n.J(Pt,IDBKeyRange.bound(t,t)):n.J()).next((e=>{const t=[];return De.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Ie(t.sequenceNumber,new Te(fo(t.readTime),new fe(Ze(t.documentKey)),t.largestBatchId)):Ie.empty(),r=e.fields.map((([e,t])=>new we(de.fromServerFormat(e),t)));return new me(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:J(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=ra(e),s=sa(e);return this.zn(e).next((e=>r.J(Pt,IDBKeyRange.bound(t,t)).next((t=>De.forEach(t,(t=>s.put(bo(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return De.forEach(t,((t,r)=>{const s=n.get(t.collectionGroup);return(s?De.resolve(s):this.getFieldIndexes(e,t.collectionGroup)).next((s=>(n.set(t.collectionGroup,s),De.forEach(s,(n=>this.jn(e,t,n).next((t=>{const s=this.Hn(r,n);return t.isEqual(s)?De.resolve():this.Jn(e,r,n,t,s)})))))))}))}Yn(e,t,n,r){return na(e).put(r.Vn(this.uid,this.Un(n,t.key),t.key))}Zn(e,t,n,r){return na(e).delete(r.mn(this.uid,this.Un(n,t.key),t.key))}jn(e,t,n){const r=na(e);let s=new mn(Lo);return r.te({index:zt,range:IDBKeyRange.only([n.indexId,this.uid,Vo(this.Un(n,t))])},((e,r)=>{s=s.add(new Po(n.indexId,t,Bo(r.arrayValue),Bo(r.directionalValue)))})).next((()=>s))}Hn(e,t){let n=new mn(Lo);const r=this.$n(t,e);if(null==r)return n;const s=pe(t);if(null!=s){const i=e.data.field(s.fieldPath);if(Zn(i))for(const s of i.arrayValue.values||[])n=n.add(new Po(t.indexId,e.key,this.kn(s),r))}else n=n.add(new Po(t.indexId,e.key,Zo,r));return n}Jn(e,t,n,r,s){A(Jo,"Updating index entries for document '%s'",t.key);const i=[];return function(e,t,n,r,s){const i=e.getIterator(),o=t.getIterator();let a=yn(i),c=yn(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=yn(o)):t?(s(a),a=yn(i)):(a=yn(i),c=yn(o))}}(r,s,Lo,(r=>{i.push(this.Yn(e,t,n,r))}),(r=>{i.push(this.Zn(e,t,n,r))})),De.waitFor(i)}zn(e){let t=1;return sa(e).te({index:Vt,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Lo(e,t))).filter(((e,t,n)=>!t||0!==Lo(e,n[t-1])));const r=[];r.push(e);for(const s of n){const n=Lo(s,e),i=Lo(s,t);if(0===n)r[0]=e.Rn();else if(n>0&&i<0)r.push(s),r.push(s.Rn());else if(i>0)break}r.push(t);const s=[];for(let e=0;e<r.length;e+=2){if(this.Xn(r[e],r[e+1]))return[];const t=r[e].mn(this.uid,Zo,fe.empty()),n=r[e+1].mn(this.uid,Zo,fe.empty());s.push(IDBKeyRange.bound(t,n))}return s}Xn(e,t){return Lo(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ia)}getMinOffset(e,t){return De.mapArray(this.xn(t),(t=>this.On(e,t).next((e=>e||R(44426))))).next(ia)}}function ta(e){return an(e,Dt)}function na(e){return an(e,Ut)}function ra(e){return an(e,Mt)}function sa(e){return an(e,Lt)}function ia(e){M(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const s=e[r].indexState.offset;Se(s,t)<0&&(t=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Te(t.readTime,t.documentKey,n)}const oa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},aa=41943040;class ca{static withCacheSize(e){return new ca(e,ca.DEFAULT_COLLECTION_PERCENTILE,ca.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function ua(e,t,n){const r=e.store(st),s=e.store(lt),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.te({range:o},((e,t,n)=>(a++,n.delete())));i.push(c.next((()=>{M(1===a,47070,{batchId:n.batchId})})));const u=[];for(const e of n.mutations){const r=ut(t,e.key.path,n.batchId);i.push(s.delete(r)),u.push(e.key)}return De.waitFor(i).next((()=>u))}function ha(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw R(14731);t=e.noDocument}return JSON.stringify(t).length}ca.DEFAULT_COLLECTION_PERCENTILE=10,ca.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ca.DEFAULT=new ca(aa,ca.DEFAULT_COLLECTION_PERCENTILE,ca.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ca.DISABLED=new ca(-1,0,0);class la{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.er={}}static bt(e,t,n,r){M(""!==e.uid,64387);const s=e.isAuthenticated()?e.uid:"";return new la(s,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fa(e).te({index:ot,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const s=ga(e),i=fa(e);return i.add({}).next((o=>{M("number"==typeof o,49019);const a=new ni(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Gi(e.wt,t))),s=n.mutations.map((t=>Gi(e.wt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.serializer,this.userId,a),u=[];let h=new mn(((e,t)=>J(e.canonicalString(),t.canonicalString())));for(const e of r){const t=ut(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(i.put(c)),u.push(s.put(t,ht))}return h.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.er[o]=a.keys()})),De.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return fa(e).get(t).next((e=>e?(M(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),go(this.serializer,e)):null))}tr(e,t){return this.er[t]?De.resolve(this.er[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.er[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return fa(e).te({index:ot,range:r},((e,t,r)=>{t.userId===this.userId&&(M(t.batchId>=n,47524,{nr:n}),s=go(this.serializer,t)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Ke;return fa(e).te({index:ot,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Ke],[this.userId,Number.POSITIVE_INFINITY]);return fa(e).J(ot,t).next((e=>e.map((e=>go(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=ct(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return ga(e).te({range:r},((n,r,i)=>{const[o,a,c]=n,u=Ze(a);if(o===this.userId&&t.path.isEqual(u))return fa(e).get(c).next((e=>{if(!e)throw R(61480,{rr:n,batchId:c});M(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:c}),s.push(go(this.serializer,e))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new mn(J);const r=[];return t.forEach((t=>{const s=ct(this.userId,t.path),i=IDBKeyRange.lowerBound(s),o=ga(e).te({range:i},((e,r,s)=>{const[i,o,a]=e,c=Ze(o);i===this.userId&&t.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),De.waitFor(r).next((()=>this.ir(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,s=ct(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new mn(J);return ga(e).te({range:i},((e,t,s)=>{const[i,a,c]=e,u=Ze(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.ir(e,o)))}ir(e,t){const n=[],r=[];return t.forEach((t=>{r.push(fa(e).get(t).next((e=>{if(null===e)throw R(35274,{batchId:t});M(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(go(this.serializer,e))})))})),De.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return ua(e.he,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.sr(t.batchId)})),De.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}sr(e){delete this.er[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return De.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return ga(e).te({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Ze(e[1]);r.push(t)}else n.done()})).next((()=>{M(0===r.length,56720,{_r:r.map((e=>e.canonicalString()))})}))}))}containsKey(e,t){return da(e,this.userId,t)}ar(e){return ma(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:Ke,lastStreamToken:""}))}}function da(e,t,n){const r=ct(t,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ga(e).te({range:i,ee:!0},((e,n,r)=>{const[i,a,c]=e;i===t&&a===s&&(o=!0),r.done()})).next((()=>o))}function fa(e){return an(e,st)}function ga(e){return an(e,lt)}function ma(e){return an(e,rt)}class pa{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new pa(0)}static lr(){return new pa(-1)}}class ya{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.hr(e).next((t=>{const n=new pa(t.highestTargetId);return t.highestTargetId=n.next(),this.Pr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.hr(e).next((e=>ae.fromTimestamp(new oe(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.hr(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.hr(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Pr(e,r))))}addTargetData(e,t){return this.Tr(e,t).next((()=>this.hr(e).next((n=>(n.targetCount+=1,this.Ir(t,n),this.Pr(e,n))))))}updateTargetData(e,t){return this.Tr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>va(e).delete(t.targetId))).next((()=>this.hr(e))).next((t=>(M(t.targetCount>0,8065),t.targetCount-=1,this.Pr(e,t))))}removeTargets(e,t,n){let r=0;const s=[];return va(e).te(((i,o)=>{const a=mo(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(e,a)))})).next((()=>De.waitFor(s))).next((()=>r))}forEachTarget(e,t){return va(e).te(((e,n)=>{const r=mo(n);t(r)}))}hr(e){return wa(e).get(xt).next((e=>(M(null!==e,2888),e)))}Pr(e,t){return wa(e).put(xt,t)}Tr(e,t){return va(e).put(po(this.serializer,t))}Ir(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.hr(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Ur(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return va(e).te({range:r,index:It},((e,n,r)=>{const i=mo(n);qr(t,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(e,t,n){const r=[],s=ba(e);return t.forEach((t=>{const i=Xe(t.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(e,n,t))})),De.waitFor(r)}removeMatchingKeys(e,t,n){const r=ba(e);return De.forEach(t,(t=>{const s=Xe(t.path);return De.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=ba(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ba(e);let s=Is();return r.te({range:n,ee:!0},((e,t,n)=>{const r=Ze(e[1]),i=new fe(r);s=s.add(i)})).next((()=>s))}containsKey(e,t){const n=Xe(t.path),r=IDBKeyRange.bound([n],[re(n)],!1,!0);let s=0;return ba(e).te({index:St,ee:!0,range:r},(([e,t],n,r)=>{0!==e&&(s++,r.done())})).next((()=>s>0))}Rt(e,t){return va(e).get(t).next((e=>e?mo(e):null))}}function va(e){return an(e,bt)}function wa(e){return an(e,At)}function ba(e){return an(e,_t)}const Ia="LruGarbageCollector",Ea=1048576;function _a([e,t],[n,r]){const s=J(e,n);return 0===s?J(t,r):s}class Ta{constructor(e){this.Er=e,this.buffer=new mn(_a),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();_a(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Sa{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){A(Ia,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Le(e)?A(Ia,"Ignoring IndexedDB error during garbage collection: ",e):await Ae(e)}await this.mr(3e5)}))}}class Ca{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return De.resolve($e.le);const n=new Ta(t);return this.gr.forEachTarget(e,(e=>n.Rr(e.sequenceNumber))).next((()=>this.gr.yr(e,(e=>n.Rr(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(oa)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oa):this.wr(e,t)))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,r,s,i,o,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),C()<=a.$b.DEBUG&&A("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e}))))}}function xa(e,t){return new Ca(e,t)}class Aa{constructor(e,t){this.db=e,this.garbageCollector=xa(this,t)}pr(e){const t=this.br(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}br(e){let t=0;return this.yr(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}yr(e,t){return this.Sr(e,((e,n)=>t(n)))}addReference(e,t,n){return Da(e,n)}removeReference(e,t,n){return Da(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Da(e,t)}Dr(e,t){return function(e,t){let n=!1;return ma(e).ne((r=>da(e,r,t).next((e=>(e&&(n=!0),De.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Sr(e,((i,o)=>{if(o<=t){const t=this.Dr(e,i).next((t=>{if(!t)return s++,n.getEntry(e,i).next((()=>(n.removeEntry(i,ae.min()),ba(e).delete(function(e){return[0,Xe(e.path)]}(i)))))}));r.push(t)}})).next((()=>De.waitFor(r))).next((()=>n.apply(e))).next((()=>s))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Da(e,t)}Sr(e,t){const n=ba(e);let r,s=$e.le;return n.te({index:St},(([e,n],{path:i,sequenceNumber:o})=>{0===e?(s!==$e.le&&t(new fe(Ze(r)),s),s=o,r=i):s=$e.le})).next((()=>{s!==$e.le&&t(new fe(Ze(r)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Da(e,t){return ba(e).put(function(e,t){return{targetId:0,path:Xe(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Na{constructor(){this.changes=new hs((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,fr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?De.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ka{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Pa(e).put(n)}removeEntry(e,t,n){return Pa(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],ho(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.vr(e,n))))}getEntry(e,t){let n=fr.newInvalidDocument(t);return Pa(e).te({index:gt,range:IDBKeyRange.only(La(t))},((e,r)=>{n=this.Cr(t,r)})).next((()=>n))}Fr(e,t){let n={size:0,document:fr.newInvalidDocument(t)};return Pa(e).te({index:gt,range:IDBKeyRange.only(La(t))},((e,r)=>{n={document:this.Cr(t,r),size:ha(r)}})).next((()=>n))}getEntries(e,t){let n=ds();return this.Mr(e,t,((e,t)=>{const r=this.Cr(e,t);n=n.insert(e,r)})).next((()=>n))}Or(e,t){let n=ds(),r=new dn(fe.comparator);return this.Mr(e,t,((e,t)=>{const s=this.Cr(e,t);n=n.insert(e,s),r=r.insert(e,ha(t))})).next((()=>({documents:n,Nr:r})))}Mr(e,t,n){if(t.isEmpty())return De.resolve();let r=new mn(Va);t.forEach((e=>r=r.add(e)));const s=IDBKeyRange.bound(La(r.first()),La(r.last())),i=r.getIterator();let o=i.getNext();return Pa(e).te({index:gt,range:s},((e,t,r)=>{const s=fe.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Va(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?r.H(La(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,s){const i=t.path,o=[i.popLast().toArray(),i.lastSegment(),ho(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pa(e).J(IDBKeyRange.bound(o,a,!0)).next((e=>{null==s||s.incrementDocumentReadCount(e.length);let n=ds();for(const s of e){const e=this.Cr(fe.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);e.isFoundDocument()&&(os(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let s=ds();const i=Fa(t,n),o=Fa(t,Te.max());return Pa(e).te({index:pt,range:IDBKeyRange.bound(i,o,!0)},((e,t,n)=>{const i=this.Cr(fe.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(i.key,i),s.size===r&&n.done()})).next((()=>s))}newChangeBuffer(e){return new Oa(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Ma(e).get(wt).next((e=>(M(!!e,20021),e)))}vr(e,t){return Ma(e).put(wt,t)}Cr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ki(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=fe.fromSegments(t.noDocument.path),r=fo(t.noDocument.readTime);n=fr.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return R(56709);{const e=fe.fromSegments(t.unknownDocument.path),r=fo(t.unknownDocument.version);n=fr.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new oe(e[0],e[1]);return ae.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ae.min()))return e}return fr.newInvalidDocument(e)}}function Ra(e){return new ka(e)}class Oa extends Na{constructor(e,t){super(),this.Br=e,this.trackRemovals=t,this.Lr=new hs((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new mn(((e,t)=>J(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Lr.get(s);if(t.push(this.Br.removeEntry(e,s,o.readTime)),i.isValidDocument()){const a=uo(this.Br.serializer,i);r=r.add(s.path.popLast());const c=ha(a);n+=c-o.size,t.push(this.Br.addEntry(e,s,a))}else if(n-=o.size,this.trackRemovals){const n=uo(this.Br.serializer,i.convertToNoDocument(ae.min()));t.push(this.Br.addEntry(e,s,n))}})),r.forEach((n=>{t.push(this.Br.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Br.updateMetadata(e,n)),De.waitFor(t)}getFromCache(e,t){return this.Br.Fr(e,t).next((e=>(this.Lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Br.Or(e,t).next((({documents:e,Nr:t})=>(t.forEach(((t,n)=>{this.Lr.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Ma(e){return an(e,vt)}function Pa(e){return an(e,dt)}function La(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Fa(e,t){const n=t.documentKey.path.toArray();return[e,ho(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Va(e,t){const n=e.path.toArray(),r=t.path.toArray();let s=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(s=J(n[e],r[e]),s)return s;return s=J(n.length,r.length),s||(s=J(n[n.length-2],r[r.length-2]),s||J(n[n.length-1],r[r.length-1]))}class Ba{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ua{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Gs(n.mutation,e,vn.empty(),oe.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Is()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Is()){const r=ps();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=gs();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ps();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Is())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let s=ds();const i=vs(),o=vs();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Xs)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Gs(o.mutation,t,o.mutation.getFieldMask(),oe.now())):i.set(t.key,vn.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Ba(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=vs();let r=new dn(((e,t)=>e-t)),s=Is();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||vn.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||Is()).add(e);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ys();c.forEach((e=>{if(!s.has(e)){const r=$s(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return De.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return fe.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xr(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):De.resolve(ps());let o=ge,a=s;return i.next((t=>De.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?De.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,Is()))).next((e=>({batchId:o,changes:ms(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new fe(t)).next((e=>{let t=gs();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=gs();return this.indexManager.getCollectionParents(e,s).next((o=>De.forEach(o,(o=>{const a=function(e,t){return new Gr(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r)))).next((e=>{s.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,fr.newInvalidDocument(r)))}));let n=gs();return e.forEach(((e,r)=>{const i=s.get(e);void 0!==i&&Gs(i.mutation,r,vn.empty(),oe.now()),os(t,r)&&(n=n.insert(e,r))})),n}))}}class qa{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return De.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Mi(e.createTime)}}(t)),De.resolve()}getNamedQuery(e,t){return De.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(e){return{name:e.name,query:yo(e.bundledQuery),readTime:Mi(e.readTime)}}(t)),De.resolve()}}class za{constructor(){this.overlays=new dn(fe.comparator),this.Qr=new Map}getOverlay(e,t){return De.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ps();return De.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.St(e,t,r)})),De.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Qr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Qr.delete(n)),De.resolve()}getOverlaysForCollection(e,t,n){const r=ps(),s=t.length+1,i=new fe(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return De.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new dn(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=ps(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=ps(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return De.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new si(t,n));let s=this.Qr.get(t);void 0===s&&(s=Is(),this.Qr.set(t,s)),this.Qr.set(t,s.add(n.key))}}class ja{constructor(){this.sessionToken=In.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,De.resolve()}}class $a{constructor(){this.$r=new mn(Ka.Ur),this.Kr=new mn(Ka.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const n=new Ka(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.zr(new Ka(e,t))}jr(e,t){e.forEach((e=>this.removeReference(e,t)))}Hr(e){const t=new fe(new he([])),n=new Ka(t,e),r=new Ka(t,e+1),s=[];return this.Kr.forEachInRange([n,r],(e=>{this.zr(e),s.push(e.key)})),s}Jr(){this.$r.forEach((e=>this.zr(e)))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new fe(new he([])),n=new Ka(t,e),r=new Ka(t,e+1);let s=Is();return this.Kr.forEachInRange([n,r],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new Ka(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Ka{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return fe.comparator(e.key,t.key)||J(e.Zr,t.Zr)}static Wr(e,t){return J(e.Zr,t.Zr)||fe.comparator(e.key,t.key)}}class Ga{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new mn(Ka.Ur)}checkEmpty(e){return De.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new ni(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.Xr=this.Xr.add(new Ka(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return De.resolve(i)}lookupMutationBatch(e,t){return De.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ti(n),s=r<0?0:r;return De.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(0===this.mutationQueue.length?Ke:this.nr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ka(t,0),r=new Ka(t,Number.POSITIVE_INFINITY),s=[];return this.Xr.forEachInRange([n,r],(e=>{const t=this.ei(e.Zr);s.push(t)})),De.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new mn(J);return t.forEach((e=>{const t=new Ka(e,0),r=new Ka(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,r],(e=>{n=n.add(e.Zr)}))})),De.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;fe.isDocumentKey(s)||(s=s.child(""));const i=new Ka(new fe(s),0);let o=new mn(J);return this.Xr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Zr)),!0)}),i),De.resolve(this.ni(o))}ni(e){const t=[];return e.forEach((e=>{const n=this.ei(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){M(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return De.forEach(t.mutations,(r=>{const s=new Ka(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Xr=n}))}sr(e){}containsKey(e,t){const n=new Ka(t,0),r=this.Xr.firstAfterOrEqual(n);return De.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Qa{constructor(e){this.ii=e,this.docs=new dn(fe.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return De.resolve(n?n.document.mutableCopy():fr.newInvalidDocument(t))}getEntries(e,t){let n=ds();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():fr.newInvalidDocument(e))})),De.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=ds();const i=t.path,o=new fe(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Se(_e(o),n)<=0||(r.has(o.key)||os(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return De.resolve(s)}getAllFromCollectionGroup(e,t,n,r){R(9500)}si(e,t){return De.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Ha(this)}getSize(e){return De.resolve(this.size)}}class Ha extends Na{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(n)})),De.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class Wa{constructor(e){this.persistence=e,this.oi=new hs((e=>Ur(e)),qr),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this._i=0,this.ai=new $a,this.targetCount=0,this.ui=pa.cr()}forEachTarget(e,t){return this.oi.forEach(((e,n)=>t(n))),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),De.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new pa(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,De.resolve()}updateTargetData(e,t){return this.Tr(t),De.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.oi.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.oi.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),De.waitFor(s).next((()=>r))}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,t){const n=this.oi.get(t)||null;return De.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),De.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((t=>{s.push(r.markPotentiallyOrphaned(e,t))})),De.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),De.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ai.Yr(t);return De.resolve(n)}containsKey(e,t){return De.resolve(this.ai.containsKey(t))}}class Xa{constructor(e,t){this.ci={},this.overlays={},this.li=new $e(0),this.hi=!1,this.hi=!0,this.Pi=new ja,this.referenceDelegate=e(this),this.Ti=new Wa(this),this.indexManager=new Xo,this.remoteDocumentCache=function(e){return new Qa(e)}((e=>this.referenceDelegate.Ii(e))),this.serializer=new co(t),this.Ei=new qa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new za,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new Ga(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){A("MemoryPersistence","Starting transaction:",e);const r=new Ya(this.li.next());return this.referenceDelegate.di(),n(r).next((e=>this.referenceDelegate.Ai(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ri(e,t){return De.or(Object.values(this.ci).map((n=>()=>n.containsKey(e,t))))}}class Ya extends xe{constructor(e){super(),this.currentSequenceNumber=e}}class Ja{constructor(e){this.persistence=e,this.Vi=new $a,this.mi=null}static fi(e){return new Ja(e)}get gi(){if(this.mi)return this.mi;throw R(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),De.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),De.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),De.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach((e=>this.gi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.gi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.gi,(n=>{const r=fe.fromPath(n);return this.pi(e,r).next((e=>{e||t.removeEntry(r,ae.min())}))})).next((()=>(this.mi=null,t.apply(e))))}updateLimboDocument(e,t){return this.pi(e,t).next((e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())}))}Ii(e){return 0}pi(e,t){return De.or([()=>De.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class Za{constructor(e,t){this.persistence=e,this.yi=new hs((e=>Xe(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=xa(this,t)}static fi(e,t){return new Za(e,t)}di(){}Ai(e){return De.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}br(e){let t=0;return this.yr(e,(e=>{t++})).next((()=>t))}yr(e,t){return De.forEach(this.yi,((n,r)=>this.Dr(e,n,r).next((e=>e?De.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.si(e,(r=>this.Dr(e,r,t).next((e=>{e||(n++,s.removeEntry(r,ae.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),De.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),De.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),De.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Xn(e.data.value)),t}Dr(e,t,n){return De.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.yi.get(t);return De.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ec{constructor(e){this.serializer=e}q(e,t,n,r){const s=new ke("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(tt)}(e),function(e){e.createObjectStore(rt,{keyPath:"userId"}),e.createObjectStore(st,{keyPath:it,autoIncrement:!0}).createIndex(ot,at,{unique:!0}),e.createObjectStore(lt)}(e),tc(e),function(e){e.createObjectStore(et)}(e));let i=De.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(_t),e.deleteObjectStore(bt),e.deleteObjectStore(At)}(e),tc(e)),i=i.next((()=>function(e){const t=e.store(At),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ae.min().toTimestamp(),targetCount:0};return t.put(xt,n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(e,t){return t.store(st).J().next((n=>{e.deleteObjectStore(st),e.createObjectStore(st,{keyPath:it,autoIncrement:!0}).createIndex(ot,at,{unique:!0});const r=t.store(st),s=n.map((e=>r.put(e)));return De.waitFor(s)}))}(e,s)))),i=i.next((()=>{!function(e){e.createObjectStore(kt,{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(i=i.next((()=>this.wi(s)))),n<6&&r>=6&&(i=i.next((()=>(function(e){e.createObjectStore(vt)}(e),this.bi(s))))),n<7&&r>=7&&(i=i.next((()=>this.Si(s)))),n<8&&r>=8&&(i=i.next((()=>this.Di(e,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(i=i.next((()=>this.Ci(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(e){e.createObjectStore(Rt,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(Ot,{keyPath:"name"})}(e)}))),n<12&&r>=12&&(i=i.next((()=>{!function(e){const t=e.createObjectStore($t,{keyPath:Kt});t.createIndex(Gt,Qt,{unique:!1}),t.createIndex(Ht,Wt,{unique:!1})}(e)}))),n<13&&r>=13&&(i=i.next((()=>function(e){const t=e.createObjectStore(dt,{keyPath:ft});t.createIndex(gt,mt),t.createIndex(pt,yt)}(e))).next((()=>this.Fi(e,s))).next((()=>e.deleteObjectStore(et)))),n<14&&r>=14&&(i=i.next((()=>this.Mi(e,s)))),n<15&&r>=15&&(i=i.next((()=>function(e){e.createObjectStore(Mt,{keyPath:"indexId",autoIncrement:!0}).createIndex(Pt,"collectionGroup",{unique:!1}),e.createObjectStore(Lt,{keyPath:Ft}).createIndex(Vt,Bt,{unique:!1}),e.createObjectStore(Ut,{keyPath:qt}).createIndex(zt,jt,{unique:!1})}(e)))),n<16&&r>=16&&(i=i.next((()=>{t.objectStore(Lt).clear()})).next((()=>{t.objectStore(Ut).clear()}))),n<17&&r>=17&&(i=i.next((()=>{!function(e){e.createObjectStore(Xt,{keyPath:"name"})}(e)}))),n<18&&r>=18&&(0,c.Ov)()&&(i=i.next((()=>{t.objectStore(Lt).clear()})).next((()=>{t.objectStore(Ut).clear()}))),i}bi(e){let t=0;return e.store(et).te(((e,n)=>{t+=ha(n)})).next((()=>{const n={byteSize:t};return e.store(vt).put(wt,n)}))}wi(e){const t=e.store(rt),n=e.store(st);return t.J().next((t=>De.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,Ke],[t.userId,t.lastAcknowledgedBatchId]);return n.J(ot,r).next((n=>De.forEach(n,(n=>{M(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const r=go(this.serializer,n);return ua(e,t.userId,r).next((()=>{}))}))))}))))}Si(e){const t=e.store(_t),n=e.store(et);return e.store(At).get(xt).next((e=>{const r=[];return n.te(((n,s)=>{const i=new he(n),o=function(e){return[0,Xe(e)]}(i);r.push(t.get(o).next((n=>n?De.resolve():(n=>t.put({targetId:0,path:Xe(n),sequenceNumber:e.highestListenSequenceNumber}))(i))))})).next((()=>De.waitFor(r)))}))}Di(e,t){e.createObjectStore(Dt,{keyPath:Nt});const n=t.store(Dt),r=new Yo,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Xe(r)})}};return t.store(et).te({ee:!0},((e,t)=>{const n=new he(e);return s(n.popLast())})).next((()=>t.store(lt).te({ee:!0},(([e,t,n],r)=>{const i=Ze(t);return s(i.popLast())}))))}Ci(e){const t=e.store(bt);return t.te(((e,n)=>{const r=mo(n),s=po(this.serializer,r);return t.put(s)}))}Fi(e,t){const n=t.store(et),r=[];return n.te(((e,n)=>{const s=t.store(dt),i=function(e){return e.document?new fe(he.fromString(e.document.name).popFirst(5)):e.noDocument?fe.fromSegments(e.noDocument.path):e.unknownDocument?fe.fromSegments(e.unknownDocument.path):R(36783)}(n).path.toArray(),o={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(s.put(o))})).next((()=>De.waitFor(r)))}Mi(e,t){const n=t.store(st),r=Ra(this.serializer),s=new Xa(Ja.fi,this.serializer.wt);return n.J().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Is();go(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),De.forEach(n,((e,n)=>{const i=new _(n),o=To.bt(this.serializer,i),a=s.getIndexManager(i),c=la.bt(i,this.serializer,a,s.referenceDelegate);return new Ua(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new on(t,$e.le),e).next()}))}))}}function tc(e){e.createObjectStore(_t,{keyPath:Tt}).createIndex(St,Ct,{unique:!0}),e.createObjectStore(bt,{keyPath:"targetId"}).createIndex(It,Et,{unique:!0}),e.createObjectStore(At)}const nc="IndexedDbPersistence",rc=18e5,sc=5e3,ic="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",oc="main";class ac{constructor(e,t,n,r,s,i,o,a,c,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.xi=s,this.window=i,this.document=o,this.Oi=c,this.Ni=u,this.Bi=h,this.li=null,this.hi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Li=null,this.inForeground=!1,this.ki=null,this.qi=null,this.Qi=Number.NEGATIVE_INFINITY,this.$i=e=>Promise.resolve(),!ac.C())throw new V(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Aa(this,r),this.Ui=t+oc,this.serializer=new co(a),this.Ki=new Re(this.Ui,this.Bi,new ec(this.serializer)),this.Pi=new Co,this.Ti=new ya(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ra(this.serializer),this.Ei=new Io,this.window&&this.window.localStorage?this.Wi=this.window.localStorage:(this.Wi=null,!1===u&&D(nc,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Gi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(F.FAILED_PRECONDITION,ic);return this.zi(),this.ji(),this.Hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ti.getHighestSequenceNumber(e)))})).then((e=>{this.li=new $e(e,this.Oi)})).then((()=>{this.hi=!0})).catch((e=>(this.Ki&&this.Ki.close(),Promise.reject(e))))}Ji(e){return this.$i=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ki.U((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.xi.enqueueAndForget((async()=>{this.started&&await this.Gi()})))}Gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>uc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Yi(e).next((e=>{e||(this.isPrimary=!1,this.xi.enqueueRetryable((()=>this.$i(!1))))}))})).next((()=>this.Zi(e))).next((t=>this.isPrimary&&!t?this.Xi(e).next((()=>!1)):!!t&&this.es(e).next((()=>!0)))))).catch((e=>{if(Le(e))return A(nc,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return A(nc,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.xi.enqueueRetryable((()=>this.$i(e))),this.isPrimary=e}))}Yi(e){return cc(e).get(nt).next((e=>De.resolve(this.ts(e))))}ns(e){return uc(e).delete(this.clientId)}async rs(){if(this.isPrimary&&!this.ss(this.Qi,rc)){this.Qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=an(e,kt);return t.J().next((e=>{const n=this._s(e,rc),r=e.filter((e=>-1===n.indexOf(e)));return De.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Wi)for(const t of e)this.Wi.removeItem(this.us(t.clientId))}}Hi(){this.qi=this.xi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Gi().then((()=>this.rs())).then((()=>this.Hi()))))}ts(e){return!!e&&e.ownerId===this.clientId}Zi(e){return this.Ni?De.resolve(!0):cc(e).get(nt).next((t=>{if(null!==t&&this.ss(t.leaseTimestampMs,sc)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new V(F.FAILED_PRECONDITION,ic);return!1}}return!(!this.networkEnabled||!this.inForeground)||uc(e).J().next((e=>void 0===this._s(e,sc).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&A(nc,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.hi=!1,this.ls(),this.qi&&(this.qi.cancel(),this.qi=null),this.hs(),this.Ps(),await this.Ki.runTransaction("shutdown","readwrite",[tt,kt],(e=>{const t=new on(e,$e.le);return this.Xi(t).next((()=>this.ns(t)))})),this.Ki.close(),this.Ts()}_s(e,t){return e.filter((e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId)))}Is(){return this.runTransaction("getActiveClients","readonly",(e=>uc(e).J().next((e=>this._s(e,rc).map((e=>e.clientId))))))}get started(){return this.hi}getGlobalsCache(){return this.Pi}getMutationQueue(e,t){return la.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ea(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return To.bt(this.serializer,e)}getBundleCache(){return this.Ei}runTransaction(e,t,n){A(nc,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=function(e){return 18===e?sn:17===e?rn:16===e?nn:15===e?tn:14===e?en:13===e?Zt:12===e?Jt:11===e?Yt:void R(60245)}(this.Bi);let i;return this.Ki.runTransaction(e,r,s,(r=>(i=new on(r,this.li?this.li.next():$e.le),"readwrite-primary"===t?this.Yi(i).next((e=>!!e||this.Zi(i))).next((t=>{if(!t)throw D(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.xi.enqueueRetryable((()=>this.$i(!1))),new V(F.FAILED_PRECONDITION,Ce);return n(i)})).next((e=>this.es(i).next((()=>e)))):this.Es(i).next((()=>n(i)))))).then((e=>(i.raiseOnCommittedEvent(),e)))}Es(e){return cc(e).get(nt).next((e=>{if(null!==e&&this.ss(e.leaseTimestampMs,sc)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Ni||this.allowTabSynchronization&&e.allowTabSynchronization))throw new V(F.FAILED_PRECONDITION,ic)}))}es(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cc(e).put(nt,t)}static C(){return Re.C()}Xi(e){const t=cc(e);return t.get(nt).next((e=>this.ts(e)?(A(nc,"Releasing primary lease."),t.delete(nt)):De.resolve()))}ss(e,t){const n=Date.now();return!(e<n-t||e>n&&(D(`Detected an update time that is in the future: ${e} > ${n}`),1))}zi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ki=()=>{this.xi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Gi())))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground="visible"===this.document.visibilityState)}hs(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)}ji(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Li=()=>{this.ls();const e=/(?:Version|Mobile)\/1[456]/;(0,c.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.xi.enterRestrictedMode(!0),this.xi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Li))}Ps(){this.Li&&(this.window.removeEventListener("pagehide",this.Li),this.Li=null)}cs(e){var t;try{const n=null!==(null===(t=this.Wi)||void 0===t?void 0:t.getItem(this.us(e)));return A(nc,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return D(nc,"Failed to get zombied client id.",e),!1}}ls(){if(this.Wi)try{this.Wi.setItem(this.us(this.clientId),String(Date.now()))}catch(e){D("Failed to set zombie client id.",e)}}Ts(){if(this.Wi)try{this.Wi.removeItem(this.us(this.clientId))}catch(e){}}us(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function cc(e){return an(e,tt)}function uc(e){return an(e,kt)}function hc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class lc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ds=n,this.As=r}static Rs(e,t){let n=Is(),r=Is();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lc(e,t.fromCache,n,r)}}class dc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fc{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=(0,c.nr)()?8:Oe((0,c.ZQ)())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ws(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.bs(e,t,r,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new dc;return this.Ss(e,t,n).next((r=>{if(s.result=r,this.fs)return this.Ds(e,t,n,r.size)}))})).next((()=>s.result))}Ds(e,t,n,r){return n.documentReadCount<this.gs?(C()<=a.$b.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",is(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),De.resolve()):(C()<=a.$b.DEBUG&&A("QueryEngine","Query:",is(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(C()<=a.$b.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",is(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Jr(t))):De.resolve())}ws(e,t){if(Wr(t))return De.resolve(null);let n=Jr(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=ns(t,null,"F"),n=Jr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const s=Is(...r);return this.ys.getDocuments(e,s).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.vs(t,r);return this.Cs(t,i,s,n.readTime)?this.ws(e,ns(t,null,"F")):this.Fs(e,i,t,n)}))))})))))}bs(e,t,n,r){return Wr(t)||r.isEqual(ae.min())?De.resolve(null):this.ys.getDocuments(e,n).next((s=>{const i=this.vs(t,s);return this.Cs(t,i,n,r)?De.resolve(null):(C()<=a.$b.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),is(t)),this.Fs(e,i,t,Ee(r,ge)).next((e=>e)))}))}vs(e,t){let n=new mn(cs(e));return t.forEach(((t,r)=>{os(e,r)&&(n=n.add(r))})),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return C()<=a.$b.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",is(t)),this.ys.getDocumentsMatchingQuery(e,t,Te.min(),n)}Fs(e,t,n,r){return this.ys.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const gc="LocalStore",mc=3e8;class pc{constructor(e,t,n,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new dn(J),this.Os=new hs((e=>Ur(e)),qr),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ua(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.xs)))}}function yc(e,t,n,r){return new pc(e,t,n,r)}async function vc(e,t){const n=L(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((s=>(r=s,n.Ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],i=[];let o=Is();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ks:e,removedBatchIds:s,addedBatchIds:i})))}))}))}function wc(e){const t=L(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ti.getLastRemoteSnapshotVersion(e)))}function bc(e,t,n){let r=Is(),s=Is();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ds();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(ae.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):A(gc,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{qs:r,Qs:s}}))}function Ic(e,t){const n=L(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=Ke),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Ec(e,t){const n=L(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ti.getTargetData(e,t).next((s=>s?(r=s,De.resolve(r)):n.Ti.allocateTargetId(e).next((s=>(r=new ao(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Ti.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.xs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.xs=n.xs.insert(e.targetId,e),n.Os.set(t,e.targetId)),e}))}async function _c(e,t,n){const r=L(e),s=r.xs.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(e=>r.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Le(e))throw e;A(gc,`Failed to update sequence numbers for target ${t}: ${e}`)}r.xs=r.xs.remove(t),r.Os.delete(s.target)}function Tc(e,t,n){const r=L(e);let s=ae.min(),i=Is();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=L(e),s=r.Os.get(n);return void 0!==s?De.resolve(r.xs.get(s)):r.Ti.getTargetData(t,n)}(r,e,Jr(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>r.Ms.getDocumentsMatchingQuery(e,t,n?s:ae.min(),n?i:Is()))).next((e=>(xc(r,as(t),e),{documents:e,$s:i})))))}function Sc(e,t){const n=L(e),r=L(n.Ti),s=n.xs.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Rt(e,t).next((e=>e?e.target:null))))}function Cc(e,t){const n=L(e),r=n.Ns.get(t)||ae.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Bs.getAllFromCollectionGroup(e,t,Ee(r,ge),Number.MAX_SAFE_INTEGER))).then((e=>(xc(n,t,e),e)))}function xc(e,t,n){let r=e.Ns.get(t)||ae.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ns.set(t,r)}async function Ac(e,t,n=Is()){const r=await Ec(e,Jr(yo(t.bundledQuery))),s=L(e);return s.persistence.runTransaction("Save named query","readwrite",(e=>{const i=Mi(t.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ei.saveNamedQuery(e,t);const o=r.withResumeToken(In.EMPTY_BYTE_STRING,i);return s.xs=s.xs.insert(o.targetId,o),s.Ti.updateTargetData(e,o).next((()=>s.Ti.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>s.Ti.addMatchingKeys(e,n,r.targetId))).next((()=>s.Ei.saveNamedQuery(e,t)))}))}const Dc="firestore_clients";function Nc(e,t){return`${Dc}_${e}_${t}`}const kc="firestore_mutations";function Rc(e,t,n){let r=`${kc}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}const Oc="firestore_targets";function Mc(e,t){return`${Oc}_${e}_${t}`}const Pc="SharedClientState";class Lc{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Gs(e,t,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new V(r.error.code,r.error.message))),i?new Lc(e,t,r.state,s):(D(Pc,`Failed to parse mutation state for ID '${t}': ${n}`),null)}zs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Fc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Gs(e,t){const n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new V(n.error.code,n.error.message))),s?new Fc(e,n.state,r):(D(Pc,`Failed to parse target state for ID '${e}': ${t}`),null)}zs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Vc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Gs(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=_s();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=He(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new Vc(e,s):(D(Pc,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Bc{constructor(e,t){this.clientId=e,this.onlineState=t}static Gs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Bc(t.clientId,t.onlineState):(D(Pc,`Failed to parse online state: ${e}`),null)}}class Uc{constructor(){this.activeTargetIds=_s()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qc{constructor(e,t,n,r,s){this.window=e,this.xi=t,this.persistenceKey=n,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ys=this.Zs.bind(this),this.Xs=new dn(J),this.started=!1,this.eo=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.no=Nc(this.persistenceKey,this.Js),this.ro=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Xs=this.Xs.insert(this.Js,new Uc),this.io=new RegExp(`^${Dc}_${i}_([^_]*)$`),this.so=new RegExp(`^${kc}_${i}_(\\d+)(?:_(.*))?$`),this.oo=new RegExp(`^${Oc}_${i}_(\\d+)$`),this._o=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.ao=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ys)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Is();for(const t of e){if(t===this.Js)continue;const e=this.getItem(Nc(this.persistenceKey,t));if(e){const n=Vc.Gs(t,e);n&&(this.Xs=this.Xs.insert(n.clientId,n))}}this.uo();const t=this.storage.getItem(this._o);if(t){const e=this.co(t);e&&this.lo(e)}for(const e of this.eo)this.Zs(e);this.eo=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.ro,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ho(this.Xs)}isActiveQueryTarget(e){let t=!1;return this.Xs.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Po(e,"pending")}updateMutationState(e,t,n){this.Po(e,t,n),this.To(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(Mc(this.persistenceKey,e));if(t){const r=Fc.Gs(e,t);r&&(n=r.state)}}return t&&this.Io.js(e),this.uo(),n}removeLocalQueryTarget(e){this.Io.Hs(e),this.uo()}isLocalQueryTarget(e){return this.Io.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Mc(this.persistenceKey,e))}updateQueryState(e,t,n){this.Eo(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.To(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Ao(e)}notifyBundleLoaded(e){this.Ro(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ys),this.removeItem(this.no),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return A(Pc,"READ",e,t),t}setItem(e,t){A(Pc,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){A(Pc,"REMOVE",e),this.storage.removeItem(e)}Zs(e){const t=e;if(t.storageArea===this.storage){if(A(Pc,"EVENT",t.key,t.newValue),t.key===this.no)return void D("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.xi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.io.test(t.key)){if(null==t.newValue){const e=this.Vo(t.key);return this.mo(e,null)}{const e=this.fo(t.key,t.newValue);if(e)return this.mo(e.clientId,e)}}else if(this.so.test(t.key)){if(null!==t.newValue){const e=this.po(t.key,t.newValue);if(e)return this.yo(e)}}else if(this.oo.test(t.key)){if(null!==t.newValue){const e=this.wo(t.key,t.newValue);if(e)return this.bo(e)}}else if(t.key===this._o){if(null!==t.newValue){const e=this.co(t.newValue);if(e)return this.lo(e)}}else if(t.key===this.ro){const e=function(e){let t=$e.le;if(null!=e)try{const n=JSON.parse(e);M("number"==typeof n,30636,{So:e}),t=n}catch(e){D(Pc,"Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==$e.le&&this.sequenceNumberHandler(e)}else if(t.key===this.ao){const e=this.Do(t.newValue);await Promise.all(e.map((e=>this.syncEngine.vo(e))))}}else this.eo.push(t)}))}}get Io(){return this.Xs.get(this.Js)}uo(){this.setItem(this.no,this.Io.zs())}Po(e,t,n){const r=new Lc(this.currentUser,e,t,n),s=Rc(this.persistenceKey,this.currentUser,e);this.setItem(s,r.zs())}To(e){const t=Rc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ao(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this._o,JSON.stringify(t))}Eo(e,t,n){const r=Mc(this.persistenceKey,e),s=new Fc(e,t,n);this.setItem(r,s.zs())}Ro(e){const t=JSON.stringify(Array.from(e));this.setItem(this.ao,t)}Vo(e){const t=this.io.exec(e);return t?t[1]:null}fo(e,t){const n=this.Vo(e);return Vc.Gs(n,t)}po(e,t){const n=this.so.exec(e),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Lc.Gs(new _(s),r,t)}wo(e,t){const n=this.oo.exec(e),r=Number(n[1]);return Fc.Gs(r,t)}co(e){return Bc.Gs(e)}Do(e){return JSON.parse(e)}async yo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);A(Pc,`Ignoring mutation for non-active user ${e.user.uid}`)}bo(e){return this.syncEngine.Fo(e.targetId,e.state,e.error)}mo(e,t){const n=t?this.Xs.insert(e,t):this.Xs.remove(e),r=this.ho(this.Xs),s=this.ho(n),i=[],o=[];return s.forEach((e=>{r.has(e)||i.push(e)})),r.forEach((e=>{s.has(e)||o.push(e)})),this.syncEngine.Mo(i,o).then((()=>{this.Xs=n}))}lo(e){this.Xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ho(e){let t=_s();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class zc{constructor(){this.xo=new Uc,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new Uc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class jc{No(e){}shutdown(){}}const $c="ConnectivityMonitor";class Kc{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){A($c,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){A($c,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gc=null;function Qc(){return null===Gc?Gc=268435456+Math.round(2147483648*Math.random()):Gc++,"0x"+Gc.toString(16)}const Hc="RestConnection",Wc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xc{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===Mn?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(e,t,n,r,s){const i=Qc(),o=this.jo(e,t.toUriEncodedString());A(Hc,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,s);const{host:u}=new URL(o),h=(0,c.zJ)(u);return this.Jo(e,o,a,n,h).then((t=>(A(Hc,`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw N(Hc,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}Yo(e,t,n,r,s,i){return this.zo(e,t,n,r,s)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+T,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}jo(e,t){const n=Wc[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class Yc{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}const Jc="WebChannelConnection";class Zc extends Xc{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const i=Qc();return new Promise(((s,o)=>{const a=new l;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case g.NO_ERROR:const t=a.getResponseJson();A(Jc,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case g.TIMEOUT:A(Jc,`RPC '${e}' ${i} timed out`),o(new V(F.DEADLINE_EXCEEDED,"Request time out"));break;case g.HTTP_ERROR:const n=a.getStatus();if(A(Jc,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(t)>=0?t:F.UNKNOWN}(t.status);o(new V(e,t.message))}else o(new V(F.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new V(F.UNAVAILABLE,"Connection failed."));break;default:R(9055,{h_:e,streamId:i,P_:a.getLastErrorCode(),T_:a.getLastError()})}}finally{A(Jc,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);A(Jc,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}I_(e,t,n){const r=Qc(),s=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=v(),o=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");A(Jc,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);this.E_(h);let l=!1,f=!1;const g=new Yc({Zo:t=>{f?A(Jc,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(A(Jc,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),A(Jc,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Xo:()=>h.close()}),w=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return w(h,d.EventType.OPEN,(()=>{f||(A(Jc,`RPC '${e}' stream ${r} transport opened.`),g.__())})),w(h,d.EventType.CLOSE,(()=>{f||(f=!0,A(Jc,`RPC '${e}' stream ${r} transport closed`),g.u_(),this.d_(h))})),w(h,d.EventType.ERROR,(t=>{f||(f=!0,N(Jc,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),g.u_(new V(F.UNAVAILABLE,"The operation could not be completed")))})),w(h,d.EventType.MESSAGE,(t=>{var n;if(!f){const s=t.data[0];M(!!s,16349);const i=s,o=(null==i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){A(Jc,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=ai[e];if(void 0!==t)return hi(t)}(t),s=o.message;void 0===n&&(n=F.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),f=!0,g.u_(new V(n,s)),h.close()}else A(Jc,`RPC '${e}' stream ${r} received:`,s),g.c_(s)}})),w(o,p.STAT_EVENT,(t=>{t.stat===m.PROXY?A(Jc,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===m.NOPROXY&&A(Jc,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{g.a_()}),0),g}terminate(){this.l_.forEach((e=>e.close())),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter((t=>t===e))}}function eu(){return"undefined"!=typeof window?window:null}function tu(){return"undefined"!=typeof document?document:null}function nu(e){return new Di(e,!0)}class ru{constructor(e,t,n=1e3,r=1.5,s=6e4){this.xi=e,this.timerId=t,this.A_=n,this.R_=r,this.V_=s,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),r=Math.max(0,t-n);r>0&&A("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,(()=>(this.g_=Date.now(),e()))),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}const su="PersistentStream";class iu{constructor(e,t,n,r,s,i,o,a){this.xi=e,this.S_=n,this.D_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new ru(e,t)}O_(){return 1===this.state||5===this.state||this.N_()}N_(){return 2===this.state||3===this.state}start(){this.M_=0,4!==this.state?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&null===this.C_&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,(()=>this.q_())))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,4!==e?this.x_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(D(t.toString()),D("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===F.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.v_===t&&this.z_(e,n)}),(t=>{e((()=>{const e=new V(F.UNKNOWN,"Fetching auth token failed: "+t.message);return this.j_(e)}))}))}z_(e,t){const n=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_((()=>{n((()=>this.listener.e_()))})),this.stream.n_((()=>{n((()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,(()=>(this.N_()&&(this.state=3),Promise.resolve()))),this.listener.n_())))})),this.stream.i_((e=>{n((()=>this.j_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.M_?this.J_(e):this.onNext(e)))}))}B_(){this.state=5,this.x_.y_((async()=>{this.state=0,this.start()}))}j_(e){return A(su,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget((()=>this.v_===e?t():(A(su,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ou extends iu{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:R(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(M(void 0===t||"string"==typeof t,58123),In.fromBase64String(t||"")):(M(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),In.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?F.UNKNOWN:hi(e.code);return new V(t,e.message||"")}(o);n=new Ii(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Bi(e,r.document.name),i=Mi(r.document.updateTime),o=r.document.createTime?Mi(r.document.createTime):ae.min(),a=new lr({mapValue:{fields:r.document.fields}}),c=fr.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new wi(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Bi(e,r.document),i=r.readTime?Mi(r.readTime):ae.min(),o=fr.newNoDocument(s,i),a=r.removedTargetIds||[];n=new wi([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Bi(e,r.document),i=r.removedTargetIds||[];n=new wi([],i,s,null)}else{if(!("filter"in t))return R(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new oi(r,s),o=e.targetId;n=new bi(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ae.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ae.min():t.readTime?Mi(t.readTime):ae.min()}(e);return this.listener.Y_(t,n)}Z_(e){const t={};t.database=zi(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=zr(r)?{documents:Hi(e,r)}:{query:Wi(e,r).gt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ri(e,t.resumeToken);const r=Ni(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ae.min())>0){n.readTime=ki(e,t.snapshotVersion.toTimestamp());const r=Ni(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Q_(t)}X_(e){const t={};t.database=zi(this.serializer),t.removeTarget=e,this.Q_(t)}}class au extends iu{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return M(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,M(!e.writeResults||0===e.writeResults.length,55816),this.listener.na()}onNext(e){M(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=function(e,t){return e&&e.length>0?(M(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?Mi(e.updateTime):Mi(t);return n.isEqual(ae.min())&&(n=Mi(t)),new Us(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Mi(e.commitTime);return this.listener.ra(n,t)}ia(){const e={};e.database=zi(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Gi(this.serializer,e)))};this.Q_(t)}}class cu{}class uu extends cu{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new V(F.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.zo(e,Li(t,n),r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new V(F.UNKNOWN,e.toString())}))}Yo(e,t,n,r,s){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Yo(e,Li(t,n),r,i,o,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new V(F.UNKNOWN,e.toString())}))}terminate(){this.sa=!0,this.connection.terminate()}}class hu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve()))))}Pa(e){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,"Online"===e&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(D(t),this.ua=!1):A("OnlineStateTracker",t)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}const lu="RemoteStore";class du{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=s,this.Ra.No((e=>{n.enqueueAndForget((async()=>{Iu(this)&&(A(lu,"Restarting streams for network reachability change."),await async function(e){const t=L(e);t.da.add(4),await gu(t),t.Va.set("Unknown"),t.da.delete(4),await fu(t)}(this))}))})),this.Va=new hu(n,r)}}async function fu(e){if(Iu(e))for(const t of e.Aa)await t(!0)}async function gu(e){for(const t of e.Aa)await t(!1)}function mu(e,t){const n=L(e);n.Ea.has(t.targetId)||(n.Ea.set(t.targetId,t),bu(n)?wu(n):Uu(n).N_()&&yu(n,t))}function pu(e,t){const n=L(e),r=Uu(n);n.Ea.delete(t),r.N_()&&vu(n,t),0===n.Ea.size&&(r.N_()?r.k_():Iu(n)&&n.Va.set("Unknown"))}function yu(e,t){if(e.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ae.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Uu(e).Z_(t)}function vu(e,t){e.ma.Ke(t),Uu(e).X_(t)}function wu(e){e.ma=new _i({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Ea.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),Uu(e).start(),e.Va.ca()}function bu(e){return Iu(e)&&!Uu(e).O_()&&e.Ea.size>0}function Iu(e){return 0===L(e).da.size}function Eu(e){e.ma=void 0}async function _u(e){e.Va.set("Online")}async function Tu(e){e.Ea.forEach(((t,n)=>{yu(e,t)}))}async function Su(e,t){Eu(e),bu(e)?(e.Va.Pa(t),wu(e)):e.Va.set("Unknown")}async function Cu(e,t,n){if(e.Va.set("Online"),t instanceof Ii&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ea.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ea.delete(r),e.ma.removeTarget(r))}(e,t)}catch(n){A(lu,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await xu(e,n)}else if(t instanceof wi?e.ma.Xe(t):t instanceof bi?e.ma.ot(t):e.ma.nt(t),!n.isEqual(ae.min()))try{const t=await wc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.ma.It(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ea.get(r);s&&e.Ea.set(r,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Ea.get(t);if(!r)return;e.Ea.set(t,r.withResumeToken(In.EMPTY_BYTE_STRING,r.snapshotVersion)),vu(e,t);const s=new ao(r.target,t,n,r.sequenceNumber);yu(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){A(lu,"Failed to raise snapshot:",t),await xu(e,t)}}async function xu(e,t,n){if(!Le(t))throw t;e.da.add(1),await gu(e),e.Va.set("Offline"),n||(n=()=>wc(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{A(lu,"Retrying IndexedDB access"),await n(),e.da.delete(1),await fu(e)}))}function Au(e,t){return t().catch((n=>xu(e,n,t)))}async function Du(e){const t=L(e),n=qu(t);let r=t.Ia.length>0?t.Ia[t.Ia.length-1].batchId:Ke;for(;Nu(t);)try{const e=await Ic(t.localStore,r);if(null===e){0===t.Ia.length&&n.k_();break}r=e.batchId,ku(t,e)}catch(e){await xu(t,e)}Ru(t)&&Ou(t)}function Nu(e){return Iu(e)&&e.Ia.length<10}function ku(e,t){e.Ia.push(t);const n=qu(e);n.N_()&&n.ea&&n.ta(t.mutations)}function Ru(e){return Iu(e)&&!qu(e).O_()&&e.Ia.length>0}function Ou(e){qu(e).start()}async function Mu(e){qu(e).ia()}async function Pu(e){const t=qu(e);for(const n of e.Ia)t.ta(n.mutations)}async function Lu(e,t,n){const r=e.Ia.shift(),s=ri.from(r,t,n);await Au(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await Du(e)}async function Fu(e,t){t&&qu(e).ea&&await async function(e,t){if(function(e){return ui(e)&&e!==F.ABORTED}(t.code)){const n=e.Ia.shift();qu(e).L_(),await Au(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Du(e)}}(e,t),Ru(e)&&Ou(e)}async function Vu(e,t){const n=L(e);n.asyncQueue.verifyOperationInProgress(),A(lu,"RemoteStore received new credentials");const r=Iu(n);n.da.add(3),await gu(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.da.delete(3),await fu(n)}async function Bu(e,t){const n=L(e);t?(n.da.delete(2),await fu(n)):t||(n.da.add(2),await gu(n),n.Va.set("Unknown"))}function Uu(e){return e.fa||(e.fa=function(e,t,n){const r=L(e);return r.oa(),new ou(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{e_:_u.bind(null,e),n_:Tu.bind(null,e),i_:Su.bind(null,e),Y_:Cu.bind(null,e)}),e.Aa.push((async t=>{t?(e.fa.L_(),bu(e)?wu(e):e.Va.set("Unknown")):(await e.fa.stop(),Eu(e))}))),e.fa}function qu(e){return e.ga||(e.ga=function(e,t,n){const r=L(e);return r.oa(),new au(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{e_:()=>Promise.resolve(),n_:Mu.bind(null,e),i_:Fu.bind(null,e),na:Pu.bind(null,e),ra:Lu.bind(null,e)}),e.Aa.push((async t=>{t?(e.ga.L_(),await Du(e)):(await e.ga.stop(),e.Ia.length>0&&(A(lu,`Stopping write stream with ${e.Ia.length} pending writes`),e.Ia=[]))}))),e.ga}class zu{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new B,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new zu(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ju(e,t){if(D("AsyncQueue",`${t}: ${e}`),Le(e))return new V(F.UNAVAILABLE,`${t}: ${e}`);throw e}class $u{static emptySet(e){return new $u(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||fe.comparator(t.key,n.key):(e,t)=>fe.comparator(e.key,t.key),this.keyedMap=gs(),this.sortedSet=new dn(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $u))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new $u;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ku{constructor(){this.pa=new dn(fe.comparator)}track(e){const t=e.doc.key,n=this.pa.get(t);n?0!==e.type&&3===n.type?this.pa=this.pa.insert(t,e):3===e.type&&1!==n.type?this.pa=this.pa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.pa=this.pa.remove(t):1===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):R(63341,{Vt:e,ya:n}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Gu{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Gu(e,t,$u.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Qu{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some((e=>e.va()))}}class Hu{constructor(){this.queries=Wu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=L(e),r=n.queries;n.queries=Wu(),r.forEach(((e,n)=>{for(const e of n.Sa)e.onError(t)}))}(this,new V(F.ABORTED,"Firestore shutting down"))}}function Wu(){return new hs((e=>ss(e)),rs)}async function Xu(e,t){const n=L(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.Da()&&t.va()&&(r=2):(i=new Qu,r=t.va()?0:1);try{switch(r){case 0:i.ba=await n.onListen(s,!0);break;case 1:i.ba=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=ju(e,`Initialization of query '${is(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,i),i.Sa.push(t),t.Fa(n.onlineState),i.ba&&t.Ma(i.ba)&&eh(n)}async function Yu(e,t){const n=L(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?s=t.va()?0:1:!i.Da()&&t.va()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ju(e,t){const n=L(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.Sa)t.Ma(e)&&(r=!0);s.ba=e}}r&&eh(n)}function Zu(e,t,n){const r=L(e),s=r.queries.get(t);if(s)for(const e of s.Sa)e.onError(n);r.queries.delete(t)}function eh(e){e.Ca.forEach((e=>{e.next()}))}var th,nh;(nh=th||(th={})).xa="default",nh.Cache="cache";class rh{constructor(e,t,n){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=n||{}}Ma(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Gu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache)return!0;if(!this.va())return!0;const n="Offline"!==t;return(!this.options.Qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qa(e){e=Gu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==th.Cache}}class sh{constructor(e,t){this.$a=e,this.byteLength=t}Ua(){return"metadata"in this.$a}}class ih{constructor(e){this.serializer=e}Us(e){return Bi(this.serializer,e)}Ks(e){return e.metadata.exists?Ki(this.serializer,e.document,!1):fr.newNoDocument(this.Us(e.metadata.name),this.Ws(e.metadata.readTime))}Ws(e){return Mi(e)}}class oh{constructor(e,t,n){this.Ka=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ah(e)}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.$a.namedQuery)this.queries.push(e.$a.namedQuery);else if(e.$a.documentMetadata){this.documents.push({metadata:e.$a.documentMetadata}),e.$a.documentMetadata.exists||++t;const n=he.fromString(e.$a.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.$a.document&&(this.documents[this.documents.length-1].document=e.$a.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){const t=new Map,n=new ih(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Us(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Is()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=L(e);let i=Is(),o=ds();for(const e of n){const n=t.Us(e.metadata.name);e.document&&(i=i.add(n));const r=t.Ks(e);r.setReadTime(t.Ws(e.metadata.readTime)),o=o.insert(n,r)}const a=s.Bs.newChangeBuffer({trackRemovals:!0}),c=await Ec(s,function(e){return Jr(Hr(he.fromString(`__bundle__/docs/${e}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(e=>bc(e,a,o).next((t=>(a.apply(e),t))).next((t=>s.Ti.removeMatchingKeysForTargetId(e,c.targetId).next((()=>s.Ti.addMatchingKeys(e,i,c.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(e,t.qs,t.Qs))).next((()=>t.qs))))))}(this.localStore,new ih(this.serializer),this.documents,this.Ka.id),t=this.Ga(this.documents);for(const e of this.queries)await Ac(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,za:this.collectionGroups,ja:e}}}function ah(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ch{constructor(e){this.key=e}}class uh{constructor(e){this.key=e}}class hh{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Is(),this.mutatedKeys=Is(),this.Za=cs(e),this.Xa=new $u(this.Za)}get eu(){return this.Ha}tu(e,t){const n=t?t.nu:new Ku,r=t?t.Xa:this.Xa;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=os(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ru(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Za(h,a)>0||c&&this.Za(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{Xa:i,nu:n,Cs:o,mutatedKeys:s}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const i=e.nu.wa();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.Za(e.doc,t.doc))),this.iu(n),r=null!=r&&r;const o=t&&!r?this.su():[],a=0===this.Ya.size&&this.current&&!r?1:0,c=a!==this.Ja;return this.Ja=a,0!==i.length||c?{snapshot:new Gu(this.query,e.Xa,s,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ou:o}:{ou:o}}Fa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Ku,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach((e=>this.Ha=this.Ha.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ha=this.Ha.delete(e))),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=Is(),this.Xa.forEach((e=>{this._u(e.key)&&(this.Ya=this.Ya.add(e.key))}));const t=[];return e.forEach((e=>{this.Ya.has(e)||t.push(new uh(e))})),this.Ya.forEach((n=>{e.has(n)||t.push(new ch(n))})),t}au(e){this.Ha=e.$s,this.Ya=Is();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return Gu.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,0===this.Ja,this.hasCachedResults)}}const lh="SyncEngine";class dh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fh{constructor(e){this.key=e,this.cu=!1}}class gh{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.lu={},this.hu=new hs((e=>ss(e)),rs),this.Pu=new Map,this.Tu=new Set,this.Iu=new dn(fe.comparator),this.Eu=new Map,this.du=new $a,this.Au={},this.Ru=new Map,this.Vu=pa.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}async function mh(e,t,n=!0){const r=$h(e);let s;const i=r.hu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.uu()):s=await yh(r,t,n,!0),s}async function ph(e,t){const n=$h(e);await yh(n,t,!0,!1)}async function yh(e,t,n,r){const s=await Ec(e.localStore,Jr(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await vh(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&mu(e.remoteStore,s),a}async function vh(e,t,n,r,s){e.fu=(t,n,r)=>async function(e,t,n,r){let s=t.view.tu(n);s.Cs&&(s=await Tc(e.localStore,t.query,!1).then((({documents:e})=>t.view.tu(e,s))));const i=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return Nh(e,t.targetId,a.ou),a.snapshot}(e,t,n,r);const i=await Tc(e.localStore,t,!0),o=new hh(t,i.$s),a=o.tu(i.documents),c=vi.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);Nh(e,n,u.ou);const h=new dh(t,n,o);return e.hu.set(t,h),e.Pu.has(n)?e.Pu.get(n).push(t):e.Pu.set(n,[t]),u.snapshot}async function wh(e,t,n){const r=L(e),s=r.hu.get(t),i=r.Pu.get(s.targetId);if(i.length>1)return r.Pu.set(s.targetId,i.filter((e=>!rs(e,t)))),void r.hu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await _c(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&pu(r.remoteStore,s.targetId),Ah(r,s.targetId)})).catch(Ae)):(Ah(r,s.targetId),await _c(r.localStore,s.targetId,!0))}async function bh(e,t){const n=L(e),r=n.hu.get(t),s=n.Pu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),pu(n.remoteStore,r.targetId))}async function Ih(e,t){const n=L(e);try{const e=await function(e,t){const n=L(e),r=t.snapshotVersion;let s=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.Bs.newChangeBuffer({trackRemovals:!0});s=n.xs;const o=[];t.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(e,i.removedDocuments,a).next((()=>n.Ti.addMatchingKeys(e,i.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(In.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=mc||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Ti.updateTargetData(e,u))}));let a=ds(),c=Is();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(bc(e,i,t.documentUpdates).next((e=>{a=e.qs,c=e.Qs}))),!r.isEqual(ae.min())){const t=n.Ti.getLastRemoteSnapshotVersion(e).next((t=>n.Ti.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return De.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.xs=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Eu.get(t);r&&(M(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.cu=!0:e.modifiedDocuments.size>0?M(r.cu,14607):e.removedDocuments.size>0&&(M(r.cu,42227),r.cu=!1))})),await Oh(n,e,t)}catch(e){await Ae(e)}}function Eh(e,t,n){const r=L(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.hu.forEach(((n,r)=>{const s=r.view.Fa(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=L(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Sa)e.Fa(t)&&(r=!0)})),r&&eh(n)}(r.eventManager,t),e.length&&r.lu.Y_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function _h(e,t,n){const r=L(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Eu.get(t),i=s&&s.key;if(i){let e=new dn(fe.comparator);e=e.insert(i,fr.newNoDocument(i,ae.min()));const n=Is().add(i),s=new yi(ae.min(),new Map,new dn(J),e,n);await Ih(r,s),r.Iu=r.Iu.remove(i),r.Eu.delete(t),Rh(r)}else await _c(r.localStore,t,!1).then((()=>Ah(r,t,n))).catch(Ae)}async function Th(e,t){const n=L(e),r=t.batch.batchId;try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),s=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=De.resolve();return i.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);M(null!==i,48541),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Is();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);xh(n,r,null),Ch(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Oh(n,e)}catch(e){await Ae(e)}}async function Sh(e,t,n){const r=L(e);try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(M(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);xh(r,t,n),Ch(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Oh(r,e)}catch(n){await Ae(n)}}function Ch(e,t){(e.Ru.get(t)||[]).forEach((e=>{e.resolve()})),e.Ru.delete(t)}function xh(e,t,n){const r=L(e);let s=r.Au[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Au[r.currentUser.toKey()]=s}}function Ah(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Pu.get(t))e.hu.delete(r),n&&e.lu.gu(r,n);e.Pu.delete(t),e.isPrimaryClient&&e.du.Hr(t).forEach((t=>{e.du.containsKey(t)||Dh(e,t)}))}function Dh(e,t){e.Tu.delete(t.path.canonicalString());const n=e.Iu.get(t);null!==n&&(pu(e.remoteStore,n),e.Iu=e.Iu.remove(t),e.Eu.delete(n),Rh(e))}function Nh(e,t,n){for(const r of n)r instanceof ch?(e.du.addReference(r.key,t),kh(e,r)):r instanceof uh?(A(lh,"Document no longer in limbo: "+r.key),e.du.removeReference(r.key,t),e.du.containsKey(r.key)||Dh(e,r.key)):R(19791,{pu:r})}function kh(e,t){const n=t.key,r=n.path.canonicalString();e.Iu.get(n)||e.Tu.has(r)||(A(lh,"New document in limbo: "+n),e.Tu.add(r),Rh(e))}function Rh(e){for(;e.Tu.size>0&&e.Iu.size<e.maxConcurrentLimboResolutions;){const t=e.Tu.values().next().value;e.Tu.delete(t);const n=new fe(he.fromString(t)),r=e.Vu.next();e.Eu.set(r,new fh(n)),e.Iu=e.Iu.insert(n,r),mu(e.remoteStore,new ao(Jr(Hr(n.path)),r,"TargetPurposeLimboResolution",$e.le))}}async function Oh(e,t,n){const r=L(e),s=[],i=[],o=[];r.hu.isEmpty()||(r.hu.forEach(((e,a)=>{o.push(r.fu(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=lc.Rs(a.targetId,e);i.push(t)}})))})),await Promise.all(o),r.lu.Y_(s),await async function(e,t){const n=L(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>De.forEach(t,(t=>De.forEach(t.ds,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>De.forEach(t.As,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Le(e))throw e;A(gc,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.xs.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.xs=n.xs.insert(t,s)}}}(r.localStore,i))}async function Mh(e,t){const n=L(e);if(!n.currentUser.isEqual(t)){A(lh,"User change. New user:",t.toKey());const e=await vc(n.localStore,t);n.currentUser=t,function(e){e.Ru.forEach((e=>{e.forEach((e=>{e.reject(new V(F.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ru.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Oh(n,e.ks)}}function Ph(e,t){const n=L(e),r=n.Eu.get(t);if(r&&r.cu)return Is().add(r.key);{let e=Is();const r=n.Pu.get(t);if(!r)return e;for(const t of r){const r=n.hu.get(t);e=e.unionWith(r.view.eu)}return e}}async function Lh(e,t){const n=L(e),r=await Tc(n.localStore,t.query,!0),s=t.view.au(r);return n.isPrimaryClient&&Nh(n,t.targetId,s.ou),s}async function Fh(e,t){const n=L(e);return Cc(n.localStore,t).then((e=>Oh(n,e)))}async function Vh(e,t,n,r){const s=L(e),i=await function(e,t){const n=L(e),r=L(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.tr(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):De.resolve(null)))))}(s.localStore,t);null!==i?("pending"===n?await Du(s.remoteStore):"acknowledged"===n||"rejected"===n?(xh(s,t,r||null),Ch(s,t),function(e,t){L(L(e).mutationQueue).sr(t)}(s.localStore,t)):R(6720,"Unknown batchState",{yu:n}),await Oh(s,i)):A(lh,"Cannot apply mutation batch with id: "+t)}async function Bh(e,t,n){const r=L(e),s=[],i=[];for(const e of t){let t;const n=r.Pu.get(e);if(n&&0!==n.length){t=await Ec(r.localStore,Jr(n[0]));for(const e of n){const t=r.hu.get(e),n=await Lh(r,t);n.snapshot&&i.push(n.snapshot)}}else{const n=await Sc(r.localStore,e);t=await Ec(r.localStore,n),await vh(r,Uh(n),e,!1,t.resumeToken)}s.push(t)}return r.lu.Y_(i),s}function Uh(e){return Qr(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function qh(e){return function(e){return L(L(e).persistence).Is()}(L(e).localStore)}async function zh(e,t,n,r){const s=L(e);if(s.mu)return void A(lh,"Ignoring unexpected query state notification.");const i=s.Pu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{const e=await Cc(s.localStore,as(i[0])),r=yi.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,In.EMPTY_BYTE_STRING);await Oh(s,e,r);break}case"rejected":await _c(s.localStore,t,!0),Ah(s,t,r);break;default:R(64155,n)}}async function jh(e,t,n){const r=$h(e);if(r.mu){for(const e of t){if(r.Pu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){A(lh,"Adding an already active target "+e);continue}const t=await Sc(r.localStore,e),n=await Ec(r.localStore,t);await vh(r,Uh(t),n.targetId,!1,n.resumeToken),mu(r.remoteStore,n)}for(const e of n)r.Pu.has(e)&&await _c(r.localStore,e,!1).then((()=>{pu(r.remoteStore,e),Ah(r,e)})).catch(Ae)}}function $h(e){const t=L(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ih.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ph.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=_h.bind(null,t),t.lu.Y_=Ju.bind(null,t.eventManager),t.lu.gu=Zu.bind(null,t.eventManager),t}function Kh(e){const t=L(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Th.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sh.bind(null,t),t}class Gh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=nu(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return yc(this.persistence,new fc,e.initialUser,this.serializer)}Su(e){return new Xa(Ja.fi,this.serializer)}bu(e){return new zc}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gh.provider={build:()=>new Gh};class Qh extends Gh{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){M(this.persistence.referenceDelegate instanceof Za,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Sa(n,e.asyncQueue,t)}Su(e){const t=void 0!==this.cacheSizeBytes?ca.withCacheSize(this.cacheSizeBytes):ca.DEFAULT;return new Xa((e=>Za.fi(e,t)),this.serializer)}}class Hh extends Gh{constructor(e,t,n){super(),this.Fu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Fu.initialize(this,e),await Kh(this.Fu.syncEngine),await Du(this.Fu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Du(e){return yc(this.persistence,new fc,e.initialUser,this.serializer)}vu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Sa(n,e.asyncQueue,t)}Cu(e,t){const n=new je(t,this.persistence);return new ze(e.asyncQueue,n)}Su(e){const t=hc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ca.withCacheSize(this.cacheSizeBytes):ca.DEFAULT;return new ac(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,eu(),tu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new zc}}class Wh extends Hh{constructor(e,t){super(e,t,!1),this.Fu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Fu.syncEngine;this.sharedClientState instanceof qc&&(this.sharedClientState.syncEngine={Co:Vh.bind(null,t),Fo:zh.bind(null,t),Mo:jh.bind(null,t),Is:qh.bind(null,t),vo:Fh.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async e=>{await async function(e,t){const n=L(e);if($h(n),Kh(n),!0===t&&!0!==n.mu){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Bh(n,e.toArray());n.mu=!0,await Bu(n.remoteStore,!0);for(const e of t)mu(n.remoteStore,e)}else if(!1===t&&!1!==n.mu){const e=[];let t=Promise.resolve();n.Pu.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?e.push(s):t=t.then((()=>(Ah(n,s),_c(n.localStore,s,!0)))),pu(n.remoteStore,s)})),await t,await Bh(n,e),function(e){const t=L(e);t.Eu.forEach(((e,n)=>{pu(t.remoteStore,n)})),t.du.Jr(),t.Eu=new Map,t.Iu=new dn(fe.comparator)}(n),n.mu=!1,await Bu(n.remoteStore,!1)}}(this.Fu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}bu(e){const t=eu();if(!qc.C(t))throw new V(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=hc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new qc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Xh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Eh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Mh.bind(null,this.syncEngine),await Bu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Hu}createDatastore(e){const t=nu(e.databaseInfo.databaseId),n=function(e){return new Zc(e)}(e.databaseInfo);return function(e,t,n,r){return new uu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new du(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>Eh(this.syncEngine,e,0)),Kc.C()?new Kc:new jc)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new gh(e,t,n,r,s,i);return o&&(a.mu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=L(e);A(lu,"RemoteStore shutting down."),t.da.add(5),await gu(t),t.Ra.shutdown(),t.Va.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}function Yh(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}Xh.provider={build:()=>new Xh};class Jh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):D("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Zh{constructor(e,t){this.Ou=e,this.serializer=t,this.metadata=new B,this.buffer=new Uint8Array,this.Nu=new TextDecoder("utf-8"),this.Bu().then((e=>{e&&e.Ua()?this.metadata.resolve(e.$a.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.$a)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Ou.cancel()}async getMetadata(){return this.metadata.promise}async wu(){return await this.getMetadata(),this.Bu()}async Bu(){const e=await this.Lu();if(null===e)return null;const t=this.Nu.decode(e),n=Number(t);isNaN(n)&&this.ku(`length string (${t}) is not valid number`);const r=await this.qu(n);return new sh(JSON.parse(r),e.length+n)}Qu(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Lu(){for(;this.Qu()<0&&!await this.$u(););if(0===this.buffer.length)return null;const e=this.Qu();e<0&&this.ku("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async qu(e){for(;this.buffer.length<e;)await this.$u()&&this.ku("Reached the end of bundle when more is expected.");const t=this.Nu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ku(e){throw this.Ou.cancel(),new Error(`Invalid bundle format: ${e}`)}async $u(){const e=await this.Ou.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class el{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=L(e),r={documents:t.map((e=>Vi(n.serializer,e)))},s=await n.Yo("BatchGetDocuments",n.serializer.databaseId,he.emptyPath(),r,t.length),i=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){M(!!t.found,43571),t.found.name,t.found.updateTime;const n=Bi(e,t.found.name),r=Mi(t.found.updateTime),s=t.found.createTime?Mi(t.found.createTime):ae.min(),i=new lr({mapValue:{fields:t.found.fields}});return fr.newFoundDocument(n,r,s,i)}(e,t):"missing"in t?function(e,t){M(!!t.missing,3894),M(!!t.readTime,22933);const n=Bi(e,t.missing),r=Mi(t.readTime);return fr.newNoDocument(n,r)}(e,t):R(7234,{result:t})}(n.serializer,e);i.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=i.get(e.toString());M(!!t,55234,{key:e}),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ei(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=fe.fromPath(t);this.mutations.push(new ti(n,this.precondition(n)))})),await async function(e,t){const n=L(e),r={writes:t.map((e=>Gi(n.serializer,e)))};await n.zo("Commit",n.serializer.databaseId,he.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw R(50498,{Uu:e.constructor.name});t=ae.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ae.min())?qs.exists(!1):qs.updateTime(t):qs.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ae.min()))throw new V(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qs.updateTime(t)}return qs.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class tl{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this.Ku=n.maxAttempts,this.x_=new ru(this.asyncQueue,"transaction_retry")}Wu(){this.Ku-=1,this.Gu()}Gu(){this.x_.y_((async()=>{const e=new el(this.datastore),t=this.zu(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.ju(e)}))))})).catch((e=>{this.ju(e)}))}))}zu(e){try{const t=this.updateFunction(e);return!Ge(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ju(e){this.Ku>0&&this.Hu(e)?(this.Ku-=1,this.asyncQueue.enqueueAndForget((()=>(this.Gu(),Promise.resolve())))):this.deferred.reject(e)}Hu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ui(t)}return!1}}const nl="FirestoreClient";class rl{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=_.UNAUTHENTICATED,this.clientId=Y.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async e=>{A(nl,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(A(nl,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new B;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ju(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function sl(e,t){e.asyncQueue.verifyOperationInProgress(),A(nl,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await vc(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function il(e,t){e.asyncQueue.verifyOperationInProgress();const n=await ol(e);A(nl,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Vu(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Vu(t.remoteStore,n))),e._onlineComponents=t}async function ol(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){A(nl,"Using user provided OfflineComponentProvider");try{await sl(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===F.FAILED_PRECONDITION||e.code===F.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;N("Error using user provided cache. Falling back to memory cache: "+n),await sl(e,new Gh)}}else A(nl,"Using default OfflineComponentProvider"),await sl(e,new Qh(void 0));return e._offlineComponents}async function al(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(A(nl,"Using user provided OnlineComponentProvider"),await il(e,e._uninitializedComponentsProvider._online)):(A(nl,"Using default OnlineComponentProvider"),await il(e,new Xh))),e._onlineComponents}function cl(e){return ol(e).then((e=>e.persistence))}function ul(e){return ol(e).then((e=>e.localStore))}function hl(e){return al(e).then((e=>e.remoteStore))}function ll(e){return al(e).then((e=>e.syncEngine))}function dl(e){return al(e).then((e=>e.datastore))}async function fl(e){const t=await al(e),n=t.eventManager;return n.onListen=mh.bind(null,t.syncEngine),n.onUnlisten=wh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ph.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=bh.bind(null,t.syncEngine),n}function gl(e,t,n={}){const r=new B;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new Jh({next:a=>{i.xu(),t.enqueueAndForget((()=>Yu(e,o)));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new V(F.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new V(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new rh(Hr(n.path),i,{includeMetadataChanges:!0,Qa:!0});return Xu(e,o)}(await fl(e),e.asyncQueue,t,n,r))),r.promise}function ml(e,t,n={}){const r=new B;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new Jh({next:n=>{i.xu(),t.enqueueAndForget((()=>Yu(e,o))),n.fromCache&&"server"===r.source?s.reject(new V(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new rh(n,i,{includeMetadataChanges:!0,Qa:!0});return Xu(e,o)}(await fl(e),e.asyncQueue,t,n,r))),r.promise}function pl(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const yl=new Map;function vl(e,t,n){if(!n)throw new V(F.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function wl(e,t,n,r){if(!0===t&&!0===r)throw new V(F.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function bl(e){if(!fe.isDocumentKey(e))throw new V(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Il(e){if(fe.isDocumentKey(e))throw new V(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function El(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":R(12329,{type:typeof e})}function _l(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new V(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=El(e);throw new V(F.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Tl(e,t){if(t<=0)throw new V(F.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const Sl="firestore.googleapis.com",Cl=!0;class xl{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new V(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Sl,this.ssl=Cl}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Cl;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=aa;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<Ea)throw new V(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pl(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new V(F.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new V(F.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new V(F.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Al{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new V(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new q;switch(e.type){case"firstParty":return new K(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new V(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=yl.get(e);t&&(A("ComponentProvider","Removing Datastore"),yl.delete(e),t.terminate())}(this),Promise.resolve()}}function Dl(e,t,n,r={}){var s;e=_l(e,Al);const i=(0,c.zJ)(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),u=`${t}:${n}`;i&&((0,c.gE)(`https://${u}`),(0,c.P1)("Firestore",!0)),o.host!==Sl&&o.host!==u&&N("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},o),{host:u,ssl:i,emulatorOptions:r});if(!(0,c.bD)(h,a)&&(e._setSettings(h),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=_.MOCK_USER;else{t=(0,c.Fy)(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new V(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _(i)}e._authCredentials=new z(new U(t,n))}}class Nl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Nl(this.firestore,e,this._query)}}class kl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new kl(this.firestore,e,this._key)}}class Rl extends Nl{constructor(e,t,n){super(e,t,Hr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new kl(this.firestore,null,new fe(e))}withConverter(e){return new Rl(this.firestore,e,this._path)}}function Ol(e,t,...n){if(e=(0,c.Ku)(e),vl("collection","path",t),e instanceof Al){const r=he.fromString(t,...n);return Il(r),new Rl(e,null,r)}{if(!(e instanceof kl||e instanceof Rl))throw new V(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(he.fromString(t,...n));return Il(r),new Rl(e.firestore,null,r)}}function Ml(e,t){if(e=_l(e,Al),vl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(F.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Nl(e,null,function(e){return new Gr(he.emptyPath(),e)}(t))}function Pl(e,t,...n){if(e=(0,c.Ku)(e),1===arguments.length&&(t=Y.newId()),vl("doc","path",t),e instanceof Al){const r=he.fromString(t,...n);return bl(r),new kl(e,null,new fe(r))}{if(!(e instanceof kl||e instanceof Rl))throw new V(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(he.fromString(t,...n));return bl(r),new kl(e.firestore,e instanceof Rl?e.converter:null,new fe(r))}}function Ll(e,t){return e=(0,c.Ku)(e),t=(0,c.Ku)(t),(e instanceof kl||e instanceof Rl)&&(t instanceof kl||t instanceof Rl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Fl(e,t){return e=(0,c.Ku)(e),t=(0,c.Ku)(t),e instanceof Nl&&t instanceof Nl&&e.firestore===t.firestore&&rs(e._query,t._query)&&e.converter===t.converter}const Vl="AsyncQueue";class Bl{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new ru(this,"async_queue_retry"),this.rc=()=>{const e=tu();e&&A(Vl,"Visibility state changed to "+e.visibilityState),this.x_.b_()},this.sc=e;const t=tu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=tu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise((()=>{}));const t=new B;return this._c((()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Ju.push(e),this.ac())))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!Le(e))throw e;A(Vl,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_((()=>this.ac()))}}_c(e){const t=this.sc.then((()=>(this.ec=!0,e().catch((e=>{throw this.Xu=e,this.ec=!1,D("INTERNAL UNHANDLED ERROR: ",Ul(e)),e})).then((e=>(this.ec=!1,e))))));return this.sc=t,t}enqueueAfterDelay(e,t,n){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const r=zu.createAndSchedule(this,e,t,n,(e=>this.uc(e)));return this.Zu.push(r),r}oc(){this.Xu&&R(47125,{cc:Ul(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do{e=this.sc,await e}while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then((()=>{this.Zu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Zu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lc()}))}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function Ul(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ql(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(e)}class zl{constructor(){this._progressObserver={},this._taskCompletionResolver=new B,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const jl=-1;class $l extends Al{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Bl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Bl(e),this._firestoreClient=void 0,await e}}}function Kl(e,t,n){n||(n=Mn);const r=(0,i.j6)(e,"firestore");if(r.isInitialized(n)){const e=r.getImmediate({identifier:n}),s=r.getOptions(n);if((0,c.bD)(s,t))return e;throw new V(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new V(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<Ea)throw new V(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&(0,c.zJ)(t.host)&&(0,c.gE)(t.host),r.initialize({options:t,instanceIdentifier:n})}function Gl(e,t){const n="object"==typeof e?e:(0,i.Sx)(),r="string"==typeof e?e:t||Mn,s=(0,i.j6)(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=(0,c.yU)("firestore");e&&Dl(s,...e)}return s}function Ql(e){if(e._terminated)throw new V(F.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Hl(e),e._firestoreClient}function Hl(e){var t,n,r;const s=e._freezeSettings(),i=function(e,t,n,r){return new On(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,pl(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new rl(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Wl(e,t){N("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return Yl(e,Xh.provider,{build:e=>new Hh(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function Xl(e){N("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();Yl(e,Xh.provider,{build:e=>new Wh(e,t.cacheSizeBytes)})}function Yl(e,t,n){if((e=_l(e,$l))._firestoreClient||e._terminated)throw new V(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new V(F.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},Hl(e)}function Jl(e){if(e._initialized&&!e._terminated)throw new V(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new B;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Re.C())return Promise.resolve();const t=e+oc;await Re.delete(t)}(hc(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Zl(e){return function(e){const t=new B;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=L(e);Iu(n.remoteStore)||A(lh,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=L(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(e===Ke)return void t.resolve();const r=n.Ru.get(e)||[];r.push(t),n.Ru.set(e,r)}catch(e){const n=ju(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await ll(e),t))),t.promise}(Ql(e=_l(e,$l)))}function ed(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await cl(e),n=await hl(e);return t.setNetworkEnabled(!0),function(e){const t=L(e);return t.da.delete(0),fu(t)}(n)}))}(Ql(e=_l(e,$l)))}function td(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await cl(e),n=await hl(e);return t.setNetworkEnabled(!1),async function(e){const t=L(e);t.da.add(0),await gu(t),t.Va.set("Offline")}(n)}))}(Ql(e=_l(e,$l)))}function nd(e){return(0,i.Us)(e.app,"firestore",e._databaseId.database),e._delete()}function rd(e,t){const n=Ql(e=_l(e,$l)),r=new zl;return function(e,t,n,r){const s=function(e,t){let n;return n="string"==typeof e?X().encode(e):e,function(e,t){return new Zh(e,t)}(function(e,t){if(e instanceof Uint8Array)return Yh(e,t);if(e instanceof ArrayBuffer)return Yh(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,nu(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=L(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=L(e),r=Mi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ei.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(ah(r));const s=new oh(r,e.localStore,t.serializer);let i=await t.wu();for(;i;){const e=await s.Wa(i);e&&n._updateProgress(e),i=await t.wu()}const o=await s.complete();return await Oh(e,o.ja,void 0),await function(e,t){const n=L(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ei.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.za)}catch(e){return N(lh,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await ll(e),s,r)}))}(n,e._databaseId,t,r),r}function sd(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=L(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ei.getNamedQuery(e,t)))}(await ul(e),t)))}(Ql(e=_l(e,$l)),t).then((t=>t?new Nl(e,null,t.query):null))}class id{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class od{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class ad{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ad(In.fromBase64String(e))}catch(e){throw new V(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ad(In.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class cd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new V(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new de(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function ud(){return new cd(ce)}class hd{constructor(e){this._methodName=e}}class ld{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}}class dd{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const fd=/^__.*__$/;class gd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Xs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ws(e,this.data,t,this.fieldTransforms)}}class md{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Xs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R(40011,{Ic:e})}}class yd{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Ec(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new yd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.dc({path:n,Rc:!1});return r.Vc(e),r}mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.dc({path:n,Rc:!1});return r.Ec(),r}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return Fd(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(0===e.length)throw this.gc("Document fields must not be empty");if(pd(this.Ic)&&fd.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class vd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||nu(e)}bc(e,t,n,r=!1){return new yd({Ic:e,methodName:t,wc:n,path:de.emptyPath(),Rc:!1,yc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wd(e){const t=e._freezeSettings(),n=nu(e._databaseId);return new vd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function bd(e,t,n,r,s,i={}){const o=e.bc(i.merge||i.mergeFields?2:0,t,n,s);Od("Data must be an object, but it was:",o,r);const a=kd(r,o);let c,u;if(i.merge)c=new vn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Md(t,r,n);if(!o.contains(s))throw new V(F.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Vd(e,s)||e.push(s)}c=new vn(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new gd(new lr(a),c,u)}class Id extends hd{_toFieldTransform(e){if(2!==e.Ic)throw 1===e.Ic?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Id}}function Ed(e,t,n){return new yd({Ic:3,wc:t.settings.wc,methodName:e._methodName,Rc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class _d extends hd{_toFieldTransform(e){return new Bs(e.path,new ks)}isEqual(e){return e instanceof _d}}class Td extends hd{constructor(e,t){super(e),this.Sc=t}_toFieldTransform(e){const t=Ed(this,e,!0),n=this.Sc.map((e=>Nd(e,t))),r=new Rs(n);return new Bs(e.path,r)}isEqual(e){return e instanceof Td&&(0,c.bD)(this.Sc,e.Sc)}}class Sd extends hd{constructor(e,t){super(e),this.Sc=t}_toFieldTransform(e){const t=Ed(this,e,!0),n=this.Sc.map((e=>Nd(e,t))),r=new Ms(n);return new Bs(e.path,r)}isEqual(e){return e instanceof Sd&&(0,c.bD)(this.Sc,e.Sc)}}class Cd extends hd{constructor(e,t){super(e),this.Dc=t}_toFieldTransform(e){const t=new Ls(e.serializer,Cs(e.serializer,this.Dc));return new Bs(e.path,t)}isEqual(e){return e instanceof Cd&&this.Dc===e.Dc}}function xd(e,t,n,r){const s=e.bc(1,t,n);Od("Data must be an object, but it was:",s,r);const i=[],o=lr.empty();un(r,((e,r)=>{const a=Ld(t,e,n);r=(0,c.Ku)(r);const u=s.mc(a);if(r instanceof Id)i.push(a);else{const e=Nd(r,u);null!=e&&(i.push(a),o.set(a,e))}}));const a=new vn(i);return new md(o,a,s.fieldTransforms)}function Ad(e,t,n,r,s,i){const o=e.bc(1,t,n),a=[Md(t,r,n)],u=[s];if(i.length%2!=0)throw new V(F.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(Md(t,i[e])),u.push(i[e+1]);const h=[],l=lr.empty();for(let e=a.length-1;e>=0;--e)if(!Vd(h,a[e])){const t=a[e];let n=u[e];n=(0,c.Ku)(n);const r=o.mc(t);if(n instanceof Id)h.push(t);else{const e=Nd(n,r);null!=e&&(h.push(t),l.set(t,e))}}const d=new vn(h);return new md(l,d,o.fieldTransforms)}function Dd(e,t,n,r=!1){return Nd(n,e.bc(r?4:3,t))}function Nd(e,t){if(Rd(e=(0,c.Ku)(e)))return Od("Unsupported field value:",t,e),kd(e,t);if(e instanceof hd)return function(e,t){if(!pd(t.Ic))throw t.gc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.gc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Rc&&4!==t.Ic)throw t.gc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Nd(s,t.fc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Cs(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=oe.fromDate(e);return{timestampValue:ki(t.serializer,n)}}if(e instanceof oe){const n=new oe(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ki(t.serializer,n)}}if(e instanceof ld)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ad)return{bytesValue:Ri(t.serializer,e._byteString)};if(e instanceof kl){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.gc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Pi(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof dd)return function(e,t){return{mapValue:{fields:{[Ln]:{stringValue:Bn},[Un]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.gc("VectorValues must only contain numeric values.");return Ts(t.serializer,e)}))}}}}}}(e,t);throw t.gc(`Unsupported field value: ${El(e)}`)}(e,t)}function kd(e,t){const n={};return ln(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):un(e,((e,r)=>{const s=Nd(r,t.Ac(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function Rd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof oe||e instanceof ld||e instanceof ad||e instanceof kl||e instanceof hd||e instanceof dd)}function Od(e,t,n){if(!Rd(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=El(n);throw"an object"===r?t.gc(e+" a custom object"):t.gc(e+" "+r)}}function Md(e,t,n){if((t=(0,c.Ku)(t))instanceof cd)return t._internalPath;if("string"==typeof t)return Ld(e,t);throw Fd("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pd=new RegExp("[~\\*/\\[\\]]");function Ld(e,t,n){if(t.search(Pd)>=0)throw Fd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new cd(...t.split("."))._internalPath}catch(r){throw Fd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Fd(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new V(F.INVALID_ARGUMENT,a+e+c)}function Vd(e,t){return e.some((e=>e.isEqual(t)))}class Bd{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new kl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ud(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(qd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ud extends Bd{data(){return super.data()}}function qd(e,t){return"string"==typeof t?Ld(e,t):t instanceof cd?t._internalPath:t._delegate._internalPath}function zd(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new V(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jd{}class $d extends jd{}function Kd(e,t,...n){let r=[];t instanceof jd&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Hd)).length,n=e.filter((e=>e instanceof Gd)).length;if(t>1||t>0&&n>0)throw new V(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Gd extends $d{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Gd(e,t,n)}_apply(e){const t=this._parse(e);return df(e._query,t),new Nl(e.firestore,e.converter,ts(e._query,t))}_parse(e){const t=wd(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new V(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){lf(o,i);const t=[];for(const n of o)t.push(hf(r,e,n));a={arrayValue:{values:t}}}else a=hf(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||lf(o,i),a=Dd(n,"where",o,"in"===i||"not-in"===i);return br.create(s,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Qd(e,t,n){const r=t,s=qd("where",e);return Gd._create(s,r,n)}class Hd extends jd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Hd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Ir.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)df(n,e),n=ts(n,e)}(e._query,t),new Nl(e.firestore,e.converter,ts(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Wd(...e){return e.forEach((e=>ff("or",e))),Hd._create("or",e)}function Xd(...e){return e.forEach((e=>ff("and",e))),Hd._create("and",e)}class Yd extends $d{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Yd(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new V(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new V(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new yr(t,n)}(e._query,this._field,this._direction);return new Nl(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Gr(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Jd(e,t="asc"){const n=t,r=qd("orderBy",e);return Yd._create(r,n)}class Zd extends $d{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Zd(e,t,n)}_apply(e){return new Nl(e.firestore,e.converter,ns(e._query,this._limit,this._limitType))}}function ef(e){return Tl("limit",e),Zd._create("limit",e,"F")}function tf(e){return Tl("limitToLast",e),Zd._create("limitToLast",e,"L")}class nf extends $d{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new nf(e,t,n)}_apply(e){const t=uf(e,this.type,this._docOrFields,this._inclusive);return new Nl(e.firestore,e.converter,function(e,t){return new Gr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function rf(...e){return nf._create("startAt",e,!0)}function sf(...e){return nf._create("startAfter",e,!1)}class of extends $d{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new of(e,t,n)}_apply(e){const t=uf(e,this.type,this._docOrFields,this._inclusive);return new Nl(e.firestore,e.converter,function(e,t){return new Gr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function af(...e){return of._create("endBefore",e,!1)}function cf(...e){return of._create("endAt",e,!0)}function uf(e,t,n,r){if(n[0]=(0,c.Ku)(n[0]),n[0]instanceof Bd)return function(e,t,n,r,s){if(!r)throw new V(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Yr(e))if(n.field.isKeyField())i.push(Yn(t,r.key));else{const e=r.data.field(n.field);if(Nn(e))throw new V(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new V(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new gr(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const s=wd(e.firestore);return function(e,t,n,r,s,i){const o=e.explicitOrderBy;if(s.length>o.length)throw new V(F.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new V(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Xr(e)&&-1!==c.indexOf("/"))throw new V(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(he.fromString(c));if(!fe.isDocumentKey(n))throw new V(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new fe(n);a.push(Yn(t,s))}else{const e=Dd(n,r,c);a.push(e)}}return new gr(a,i)}(e._query,e.firestore._databaseId,s,t,n,r)}}function hf(e,t,n){if("string"==typeof(n=(0,c.Ku)(n))){if(""===n)throw new V(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xr(t)&&-1!==n.indexOf("/"))throw new V(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(he.fromString(n));if(!fe.isDocumentKey(r))throw new V(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yn(e,new fe(r))}if(n instanceof kl)return Yn(e,n._key);throw new V(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${El(n)}.`)}function lf(e,t){if(!Array.isArray(e)||0===e.length)throw new V(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function df(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new V(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function ff(e,t){if(!(t instanceof Gd||t instanceof Hd))throw new V(F.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class gf{convertValue(e,t="none"){switch(zn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw R(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return un(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const s=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Un].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>Tn(e.doubleValue)));return new dd(s)}convertGeoPoint(e){return new ld(Tn(e.latitude),Tn(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=kn(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Rn(e));default:return null}}convertTimestamp(e){const t=_n(e);return new oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=he.fromString(e);M(oo(n),9688,{name:e});const r=new Pn(n.get(1),n.get(3)),s=new fe(n.popFirst(5));return r.isEqual(t)||D(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function mf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class pf extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new ad(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new kl(this.firestore,null,t)}}function yf(e){return new id("sum",Md("sum",e))}function vf(e){return new id("avg",Md("average",e))}function wf(){return new id("count")}function bf(e,t){var n,r;return e instanceof id&&t instanceof id&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())}function If(e,t){return Fl(e.query,t.query)&&(0,c.bD)(e.data(),t.data())}class Ef{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _f extends Bd{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Tf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(qd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Tf extends _f{data(e={}){return super.data(e)}}class Sf{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ef(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Tf(this._firestore,this._userDataWriter,n.key,n,new Ef(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Tf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Ef(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Tf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Ef(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Cf(t.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Cf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R(61501,{type:e})}}function xf(e,t){return e instanceof _f&&t instanceof _f?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Sf&&t instanceof Sf&&e._firestore===t._firestore&&Fl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Af(e){e=_l(e,kl);const t=_l(e.firestore,$l);return gl(Ql(t),e._key).then((n=>zf(t,e,n)))}class Df extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new ad(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new kl(this.firestore,null,t)}}function Nf(e){e=_l(e,kl);const t=_l(e.firestore,$l),n=Ql(t),r=new Df(t);return function(e,t){const n=new B;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=L(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new V(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=ju(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await ul(e),t,n))),n.promise}(n,e._key).then((n=>new _f(t,r,e._key,n,new Ef(null!==n&&n.hasLocalMutations,!0),e.converter)))}function kf(e){e=_l(e,kl);const t=_l(e.firestore,$l);return gl(Ql(t),e._key,{source:"server"}).then((n=>zf(t,e,n)))}function Rf(e){e=_l(e,Nl);const t=_l(e.firestore,$l),n=Ql(t),r=new Df(t);return zd(e._query),ml(n,e._query).then((n=>new Sf(t,r,e,n)))}function Of(e){e=_l(e,Nl);const t=_l(e.firestore,$l),n=Ql(t),r=new Df(t);return function(e,t){const n=new B;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Tc(e,t,!0),s=new hh(t,r.$s),i=s.tu(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(e){const r=ju(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await ul(e),t,n))),n.promise}(n,e._query).then((n=>new Sf(t,r,e,n)))}function Mf(e){e=_l(e,Nl);const t=_l(e.firestore,$l),n=Ql(t),r=new Df(t);return ml(n,e._query,{source:"server"}).then((n=>new Sf(t,r,e,n)))}function Pf(e,t,n){e=_l(e,kl);const r=_l(e.firestore,$l),s=mf(e.converter,t,n);return qf(r,[bd(wd(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,qs.none())])}function Lf(e,t,n,...r){e=_l(e,kl);const s=_l(e.firestore,$l),i=wd(s);let o;return o="string"==typeof(t=(0,c.Ku)(t))||t instanceof cd?Ad(i,"updateDoc",e._key,t,n,r):xd(i,"updateDoc",e._key,t),qf(s,[o.toMutation(e._key,qs.exists(!0))])}function Ff(e){return qf(_l(e.firestore,$l),[new ei(e._key,qs.none())])}function Vf(e,t){const n=_l(e.firestore,$l),r=Pl(e),s=mf(e.converter,t);return qf(n,[bd(wd(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,qs.exists(!1))]).then((()=>r))}function Bf(e,...t){var n,r,s;e=(0,c.Ku)(e);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||ql(t[o])||(i=t[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(ql(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let u,h,l;if(e instanceof kl)h=_l(e.firestore,$l),l=Hr(e._key.path),u={next:n=>{t[o]&&t[o](zf(h,e,n))},error:t[o+1],complete:t[o+2]};else{const n=_l(e,Nl);h=_l(n.firestore,$l),l=n._query;const r=new Df(h);u={next:e=>{t[o]&&t[o](new Sf(h,r,n,e))},error:t[o+1],complete:t[o+2]},zd(e._query)}return function(e,t,n,r){const s=new Jh(r),i=new rh(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>Xu(await fl(e),i))),()=>{s.xu(),e.asyncQueue.enqueueAndForget((async()=>Yu(await fl(e),i)))}}(Ql(h),l,a,u)}function Uf(e,t){return function(e,t){const n=new Jh(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){L(e).Ca.add(t),t.next()}(await fl(e),n))),()=>{n.xu(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){L(e).Ca.delete(t)}(await fl(e),n)))}}(Ql(e=_l(e,$l)),ql(t)?t:{next:t})}function qf(e,t){return function(e,t){const n=new B;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Kh(e);try{const e=await function(e,t){const n=L(e),r=oe.now(),s=t.reduce(((e,t)=>e.add(t.key)),Is());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ds(),c=Is();return n.Bs.getEntries(e,s).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((s=>{i=s;const o=[];for(const e of t){const t=Qs(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new Xs(e.key,t,dr(t.value.mapValue),qs.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ms(i)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Au[e.currentUser.toKey()];r||(r=new dn(J)),r=r.insert(t,n),e.Au[e.currentUser.toKey()]=r}(r,e.batchId,n),await Oh(r,e.changes),await Du(r.remoteStore)}catch(e){const t=ju(e,"Failed to persist write");n.reject(t)}}(await ll(e),t,n))),n.promise}(Ql(e),t)}function zf(e,t,n){const r=n.docs.get(t._key),s=new Df(e);return new _f(e,s,t._key,r,new Ef(n.hasPendingWrites,n.fromCache),t.converter)}function jf(e){return $f(e,{count:wf()})}function $f(e,t){const n=_l(e.firestore,$l),r=Ql(n),s=hn(t,((e,t)=>new ii(t,e.aggregateType,e._internalFieldPath)));return function(e,t,n){const r=new B;return e.asyncQueue.enqueueAndForget((async()=>{try{const s=await dl(e);r.resolve(async function(e,t,n){var r;const s=L(e),{request:i,yt:o,parent:a}=Xi(s.serializer,Zr(t),n);s.connection.Uo||delete i.parent;const c=(await s.Yo("RunAggregationQuery",s.serializer.databaseId,a,i,1)).filter((e=>!!e.result));M(1===c.length,64727);const u=null===(r=c[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce(((e,t)=>(e[o[t]]=u[t],e)),{})}(s,t,n))}catch(e){r.reject(e)}})),r.promise}(r,e._query,s).then((t=>function(e,t,n){const r=new Df(e);return new od(t,r,n)}(n,e,t)))}class Kf{constructor(e){this.kind="memory",this._onlineComponentProvider=Xh.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Qh(void 0)}}toJSON(){return{kind:this.kind}}}class Gf{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=tg(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Qf{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Gh.provider}toJSON(){return{kind:this.kind}}}class Hf{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Qh(e)}}toJSON(){return{kind:this.kind}}}function Wf(){return new Qf}function Xf(e){return new Hf(null==e?void 0:e.cacheSizeBytes)}function Yf(e){return new Kf(e)}function Jf(e){return new Gf(e)}class Zf{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Xh.provider,this._offlineComponentProvider={build:t=>new Hh(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class eg{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Xh.provider,this._offlineComponentProvider={build:t=>new Wh(t,null==e?void 0:e.cacheSizeBytes)}}}function tg(e){return new Zf(null==e?void 0:e.forceOwnership)}function ng(){return new eg}const rg={maxAttempts:5};class sg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=wd(e)}set(e,t,n){this._verifyNotCommitted();const r=ig(e,this._firestore),s=mf(r.converter,t,n),i=bd(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,qs.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const s=ig(e,this._firestore);let i;return i="string"==typeof(t=(0,c.Ku)(t))||t instanceof cd?Ad(this._dataReader,"WriteBatch.update",s._key,t,n,r):xd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,qs.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ig(e,this._firestore);return this._mutations=this._mutations.concat(new ei(t._key,qs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ig(e,t){if((e=(0,c.Ku)(e)).firestore!==t)throw new V(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class og{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=wd(e)}get(e){const t=ig(e,this._firestore),n=new pf(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return R(24041);const r=e[0];if(r.isFoundDocument())return new Bd(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Bd(this._firestore,n,t._key,null,t.converter);throw R(18433,{doc:r})}))}set(e,t,n){const r=ig(e,this._firestore),s=mf(r.converter,t,n),i=bd(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){const s=ig(e,this._firestore);let i;return i="string"==typeof(t=(0,c.Ku)(t))||t instanceof cd?Ad(this._dataReader,"Transaction.update",s._key,t,n,r):xd(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){const t=ig(e,this._firestore);return this._transaction.delete(t._key),this}}class ag extends og{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ig(e,this._firestore),n=new Df(this._firestore);return super.get(e).then((e=>new _f(this._firestore,n,t._key,e._document,new Ef(!1,!1),t.converter)))}}function cg(e,t,n){e=_l(e,$l);const r=Object.assign(Object.assign({},rg),n);return function(e){if(e.maxAttempts<1)throw new V(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new B;return e.asyncQueue.enqueueAndForget((async()=>{const s=await dl(e);new tl(e.asyncQueue,s,n,t,r).Wu()})),r.promise}(Ql(e),(n=>t(new ag(e,n))),r)}function ug(){return new Id("deleteField")}function hg(){return new _d("serverTimestamp")}function lg(...e){return new Td("arrayUnion",e)}function dg(...e){return new Sd("arrayRemove",e)}function fg(e){return new Cd("increment",e)}function gg(e){return new dd(e)}function mg(e){return Ql(e=_l(e,$l)),new sg(e,(t=>qf(e,t)))}function pg(e,t){const n=Ql(e=_l(e,$l));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return N("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(e){const t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new V(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(const e of t.indexes){const t=yg(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(const t of e.fields){const e=Ld("setIndexConfiguration",yg(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new we(e,2)):"ASCENDING"===t.order?r.push(new we(e,0)):"DESCENDING"===t.order&&r.push(new we(e,1))}n.push(new me(me.UNKNOWN_ID,t,r,Ie.empty()))}return n}(t);return function(e,t){return e.asyncQueue.enqueue((async()=>async function(e,t){const n=L(e),r=n.indexManager,s=[];return n.persistence.runTransaction("Configure indexes","readwrite",(e=>r.getFieldIndexes(e).next((n=>function(e,t,n,r,s){e=[...e],t=[...t],e.sort(n),t.sort(n);const i=e.length,o=t.length;let a=0,c=0;for(;a<o&&c<i;){const i=n(e[c],t[a]);i<0?s(e[c++]):i>0?r(t[a++]):(a++,c++)}for(;a<o;)r(t[a++]);for(;c<i;)s(e[c++])}(n,t,ve,(t=>{s.push(r.addFieldIndex(e,t))}),(t=>{s.push(r.deleteFieldIndex(e,t))})))).next((()=>De.waitFor(s)))))}(await ul(e),t)))}(n,r)}function yg(e,t){if("string"!=typeof e[t])throw new V(F.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class vg{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function wg(e){var t;e=_l(e,$l);const n=Tg.get(e);if(n)return n;if("persistent"!==(null===(t=Ql(e)._uninitializedComponentsProvider)||void 0===t?void 0:t._offline.kind))return null;const r=new vg(e);return Tg.set(e,r),r}function bg(e){_g(e,!0)}function Ig(e){_g(e,!1)}function Eg(e){(function(e){return e.asyncQueue.enqueue((async()=>function(e){const t=L(e),n=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",(e=>n.deleteAllFieldIndexes(e)))}(await ul(e))))})(Ql(e._firestore)).then((e=>A("deleting all persistent cache indexes succeeded"))).catch((e=>N("deleting all persistent cache indexes failed",e)))}function _g(e,t){(function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){L(e).Ms.fs=t}(await ul(e),t)))})(Ql(e._firestore),t).then((e=>A(`setting persistent cache index auto creation isEnabled=${t} succeeded`))).catch((e=>N(`setting persistent cache index auto creation isEnabled=${t} failed`,e)))}const Tg=new WeakMap;function Sg(e){var t;const n=null===(t=Ql(_l(e.firestore,$l))._onlineComponents)||void 0===t?void 0:t.datastore.serializer;return void 0===n?null:Wi(n,Jr(e._query)).gt}function Cg(e,t){var n;const r=hn(t,((e,t)=>new ii(t,e.aggregateType,e._internalFieldPath))),s=null===(n=Ql(_l(e.firestore,$l))._onlineComponents)||void 0===n?void 0:n.datastore.serializer;return void 0===s?null:Xi(s,Zr(e._query),r,!0).request}class xg{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Ag.instance.onExistenceFilterMismatch(e)}}class Ag{constructor(){this.vc=new Map}static get instance(){return Dg||(Dg=new Ag,function(e){if(li)throw new Error("a TestingHooksSpi instance is already set");li=e}(Dg)),Dg}ht(e){this.vc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.vc;return n.set(t,e),()=>n.delete(t)}}let Dg=null;!function(e,t=!0){!function(e){T=e}(i.MF),(0,i.om)(new o.uA("firestore",((e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new $l(new j(e.getProvider("auth-internal")),new Q(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new V(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pn(e.options.projectId,t)}(s,n),s);return r=Object.assign({useFetchStreams:t},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(I,E,e),(0,i.KO)(I,E,"esm2017")}()},990:(e,t,n)=>{n.d(t,{MF:()=>he,j6:()=>ie,xZ:()=>ae,om:()=>se,Us:()=>oe,Sx:()=>de,Wp:()=>le,KO:()=>fe});var r=n(125),s=n(424),i=n(126);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function g(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),m(c.get(this))}:function(...e){return m(t.apply(p(this),e))}:function(e,...n){const r=t.call(p(this),e,...n);return h.set(r,e.sort?e.sort():[e]),m(r)}:(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));u.set(e,t)}(e),n=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,f):e);var t,n}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(m(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&c.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=g(e);return t!==e&&(l.set(e,t),d.set(t,e)),t}const p=e=>d.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return w.set(t,i),i}var I;I=f,f={...I,get:(e,t,n)=>b(e,t)||I.get(e,t,n),has:(e,t)=>!!b(e,t)||I.has(e,t)};class E{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const _="@firebase/app",T="0.13.1",S=new s.Vy("@firebase/app"),C="@firebase/app-compat",x="@firebase/analytics-compat",A="@firebase/analytics",D="@firebase/app-check-compat",N="@firebase/app-check",k="@firebase/auth",R="@firebase/auth-compat",O="@firebase/database",M="@firebase/data-connect",P="@firebase/database-compat",L="@firebase/functions",F="@firebase/functions-compat",V="@firebase/installations",B="@firebase/installations-compat",U="@firebase/messaging",q="@firebase/messaging-compat",z="@firebase/performance",j="@firebase/performance-compat",$="@firebase/remote-config",K="@firebase/remote-config-compat",G="@firebase/storage",Q="@firebase/storage-compat",H="@firebase/firestore",W="@firebase/ai",X="@firebase/firestore-compat",Y="firebase",J="[DEFAULT]",Z={[_]:"fire-core",[C]:"fire-core-compat",[A]:"fire-analytics",[x]:"fire-analytics-compat",[N]:"fire-app-check",[D]:"fire-app-check-compat",[k]:"fire-auth",[R]:"fire-auth-compat",[O]:"fire-rtdb",[M]:"fire-data-connect",[P]:"fire-rtdb-compat",[L]:"fire-fn",[F]:"fire-fn-compat",[V]:"fire-iid",[B]:"fire-iid-compat",[U]:"fire-fcm",[q]:"fire-fcm-compat",[z]:"fire-perf",[j]:"fire-perf-compat",[$]:"fire-rc",[K]:"fire-rc-compat",[G]:"fire-gcs",[Q]:"fire-gcs-compat",[H]:"fire-fst",[X]:"fire-fst-compat",[W]:"fire-vertex","fire-js":"fire-js",[Y]:"fire-js-all"},ee=new Map,te=new Map,ne=new Map;function re(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function se(e){const t=e.name;if(ne.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;ne.set(t,e);for(const t of ee.values())re(t,e);for(const t of te.values())re(t,e);return!0}function ie(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function oe(e,t,n=J){ie(e,t).clearInstance(n)}function ae(e){return null!=e&&void 0!==e.settings}const ce=new i.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ue{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ce.create("app-deleted",{appName:this._name})}}const he="11.9.0";function le(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s=Object.assign({name:J,automaticDataCollectionEnabled:!0},t),o=s.name;if("string"!=typeof o||!o)throw ce.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.T9)()),!n)throw ce.create("no-options");const a=ee.get(o);if(a){if((0,i.bD)(n,a.options)&&(0,i.bD)(s,a.config))return a;throw ce.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const e of ne.values())c.addComponent(e);const u=new ue(n,s,c);return ee.set(o,u),u}function de(e=J){const t=ee.get(e);if(!t&&e===J&&(0,i.T9)())return le();if(!t)throw ce.create("no-app",{appName:e});return t}function fe(e,t,n){var s;let i=null!==(s=Z[e])&&void 0!==s?s:e;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${i}" with version "${t}":`];return o&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}se(new r.uA(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const ge="firebase-heartbeat-store";let me=null;function pe(){return me||(me=function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=m(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(m(o.result),e.oldVersion,e.newVersion,m(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ge)}catch(e){console.warn(e)}}}).catch((e=>{throw ce.create("idb-open",{originalErrorMessage:e.message})}))),me}async function ye(e,t){try{const n=(await pe()).transaction(ge,"readwrite"),r=n.objectStore(ge);await r.put(t,ve(e)),await n.done}catch(e){if(e instanceof i.g)S.warn(e.message);else{const t=ce.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}function ve(e){return`${e.name}!${e.options.appId}`}class we{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ie(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=be();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){S.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=be(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Ee(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ee(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=(0,i.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return S.warn(e),""}}}function be(){return(new Date).toISOString().substring(0,10)}class Ie{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.zW)()&&(0,i.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await pe()).transaction(ge),n=await t.objectStore(ge).get(ve(e));return await t.done,n}catch(e){if(e instanceof i.g)S.warn(e.message);else{const t=ce.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ye(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ye(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ee(e){return(0,i.Uj)(JSON.stringify({version:2,heartbeats:e})).length}se(new r.uA("platform-logger",(e=>new E(e)),"PRIVATE")),se(new r.uA("heartbeat",(e=>new we(e)),"PRIVATE")),fe(_,T,""),fe(_,T,"esm2017"),fe("fire-js","")}}]);